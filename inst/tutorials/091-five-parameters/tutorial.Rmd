---
title: Five Parameters
author: David Kane and Sanaka Dash
tutorial:
  id: five-parameters
output:
  learnr::tutorial:
    progressive: yes
    'allow_skip:': yes
runtime: shiny_prerendered
description: 'Chapter 9 Tutorial: Five Parameters'
---

```{r setup, include = FALSE}
library(learnr)
library(tutorial.helpers)
library(gt)
library(tidyverse)
library(brms)
library(tidybayes)
library(gtsummary)
library(primer.data)

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 600, 
        tutorial.storage = "local") 

df1 <- governors |> 
  select(last_name, year, state, sex, lived_after, election_age)

# fit_all <- brm(data = df1,
#                formula = lived_after ~ sex*election_age,
#                silent = 2,
#                refresh = 0,
#                seed = 13)
# 
# write_rds(fit_all, "data/fit_all.rds")

fit_all <- read_rds("data/fit_all.rds")

ndata <- tibble(sex = c("Male", "Female"), 
                election_age = 50)
```

```{r copy-code-chunk, child = system.file("child_documents/copy_button.Rmd", package = "tutorial.helpers")}
```

```{r info-section, child = system.file("child_documents/info_section.Rmd", package = "tutorial.helpers")}
```

<!-- DK: FIX - Knowledge Drop Hashes need to be removed -->

<!-- DK: Key problems with current version: We need (?) to flesh out the Courage and Temperance sections. Key skills to practice each time including writing math formulas in Quarto and creating nice looking tables of regression results. -->


## Introduction
### 

STILL A DRAFT. DON'T START.

This tutorial covers [Chapter 9: Five Parameters](https://ppbds.github.io/primer/XX.html) of [*Preceptor’s Primer for Bayesian Data Science: Using the Cardinal Virtues for Inference*](https://ppbds.github.io/primer/) by [David Kane](https://davidkane.info/). 

<!-- DK: Use the same variable, sex, in both cases. Assume a magic pill for the causal model. -->

## The Question
### 

### Exercise 1

Load **tidyverse**.

```{r the-question-1, exercise = TRUE}

```

```{r the-question-1-hint-1, eval = FALSE}
library(tidyverse)
```

```{r the-question-1-test, include = FALSE}
library(tidyverse)
```

### 

We will be working with information about candidates for governor in the United States. The data was collected for “[Longevity Returns to Political Office](https://doi.org/10.1017/psrm.2019.63)” by Sebastian Barfort, Robert Klemmensen, and Erik Gahner Larsen ([pdf](https://github.com/PPBDS/primer.data/blob/master/inst/papers/governors.pdf)).

### Exercise 2

Load the **primer.data** package.

```{r the-question-2, exercise = TRUE}

```

```{r the-question-2-hint-1, eval = FALSE}
library(primer.data)
```

```{r the-question-2-test, include = FALSE}
library(primer.data)
```

### 

A version of the data from Barfort et al (2020) is available in the `governors` tibble.


### Exercise 3

After loading **primer.data** in your Console, type `?governors` in the Console, and paste in the Description below.

```{r the-question-3}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

The abstract of the paper: 

> Does political office cause worse or better longevity prospects? Two perspectives in the literature offer contradicting answers. First, increased income, social status, and political connections obtained through holding office can increase longevity. Second, increased stress and working hours associated with holding office can have detrimental effects on longevity. To provide causal evidence, we exploit a regression discontinuity design with unique data on the longevity of candidates for US gubernatorial office. The results show that politicians winning a close election live 5–10 years longer than candidates who lose.

### Exercise 4

Longevity i.e., how long people live, is the broad topic of this tutorial. Given that topic, which variable in `governors` should we use as our outcome variable? 

```{r the-question-4}
question_text(NULL,
	message = "We will use `lived_after`. It would not be unreasonable to use `death_age`.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 2)
```

### 

`lived_after` is the years a candidate lived after the election took place.

### Exercise 5

Pick a variable in the data which might have a connection to the outcome variable and which we might consider to be, at least in theory, a treatment. (If you don't see a reasonable variable in the data, you can just name a variable which *might have been* included in the data.) How might we manipulate this variable?


```{r the-question-5}
question_text(NULL,
	message = "We can manipulate the value of XX, at least in theory, by . . .",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

<!-- There is nothing wrong with naming an imaginary variable which is not in the data set if there is not a natural one. For example, if `height` is our outcome and `nhanes` is our tibble, then maybe there isn't a good candidate treatment variable. In that case, just assume the existence of a `vitamin` binary variable for which `1` means that the individual ate vitamins growing up and `0` means they did not. -->

<!-- XX: This question and the ones that follow are tricky. We are trying to drive home some related points. First, any data set can be used to construct a causal model as long as there is at least one covariate that we can, at least in theory, manipulate. It does not matter whether or not anyone did, in fact, manipulate it. Second, any data set can be used to construct a predictive model. Third, the same data set can be used to create, separately, lots and lots of different models, both causal and predictive. We can just use different outcome variables and/or specify different treatment variables. All of this stuff is a *conceptual* framework we apply to the data. It is never inherent in the data itself.-->

<!-- XX: Explain that there is no right answer and that the student's response was probably fine. But, going forward, the student should use the variable we have selected. That variable should be named in future questions so that this is clear to the stundent. -->

### Exercise 6

Write a sentence which speculates as to the different potential outcomes which we might observe in `XX` when we change the value of the treatment variable `XX`. 


```{r the-question-6}
question_text(NULL,
	message = "XX: The value of `XX` would demonstrate XX different potential outcomes for each unit as we vary the treatment variable.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

<!-- XX: Again, we allow the student to answer however they like. But, in succeeding questions, we make it clear that they should use our answer. For example, once we specify different values for treatment in this questions, we use those values in the next. -->

<!-- XX: More tricky discussion. The point of the Rubin Causal Models is that the definition of a causal effect is the difference between potential outcomes. So, there must be two (or more) potential outcomes for any causal model to make sense. This is simplest to discuss when the treatment only has two different values, thereby generating only two potential outcomes. But, if the treatment variable is continuous, (like income) then there are lots and lots of potential outcomes, one for each possible value of the treatment variable. -->

### Exercise 7

Write a few sentences which specify two different values for the treatment variable, for a single unit, and then guesses at the potential outcomes which would result, and then calculates the causal effect for that unit given those guesses.

<!-- XX: Replace "unitXX" with a better word below given the actual data set we are using. Replace all the XX terms as appropriate. -->

```{r the-question-7}
question_text(NULL,
	message = "For a given unitXX, assume that the value of the treatment variables might be 'XX_1' or 'XX_2'. If the unitXX gets 'XX_1', then the outcome would be XX_out_1. If the unitXX gets 'XX_1', then the outcome would be XX_out_2. The causal effect on the outcome of a treatment of 'XX_1' versus 'XX_2' is XX_out_1 - XX_out_2, which equals XX_ce.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

<!-- XX: More trickiness. Again, we are trying to reinforce the the definition of a causal effect as the difference between two potential outcomes. Of course, you can't just say that the causal effect is 10. The exact value depends on which potential outcome comes first in the subtraction and which second. (There is, perhaps, a default sense in which the causal effect is defined as treatment minus control. But regardless, it is better to be clear.) -->

<!-- XX: Something like: "The causal effect on attitude toward immigration of treatment versus control is 1.5." Which implies that it is treatment minus control. Or: "The causal effect on longevity of receiving an income of 20,000 versus one of 19,000 is 6 year." In both cases, we specify the outcome variable explicitly. -->

<!-- XX: Throughout, we are making clear that any causal connection means exploring the *within row* different between two potential outcomes. We don't need to look at any other rows to have that conversation. -->

### Exercise 8

Let's consider a *predictive* model. Which variable in `XX: the tibble` do you think might have an important connection to `XX: the outcome variable`?

<!-- XX: We don't give the option of imagining a new variable. Maybe we should to be consistent? -->

```{r the-question-8}
question_text(NULL,
	message = "XX: Describe the (or one of) the key covariate whose connection to the outcome variable we most want to explore.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 2)
```

### 

<!-- XX: Acknowledge that there is no right answer. There are other interesting variable in this data set --- mention some of them --- that we might also explore. But, again, in this tutorial, we have selected the outcome and the key covariate which will be used. -->

### Exercise 9

Write a few sentences which specify two different groups of unitsXX with different values for XX. Explain that the outcome variable might differ between these two groups.

```{r the-question-9}
question_text(NULL,
	message = "XX: Some unitsXX might have a value for XX of XX_1. Others might have a value of XX_2. Those two groups will, on average, have different values for the outcome variable.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

<!-- XX: Again, the key point is that, with a predictive model, there is only one outcome for each individual unit. There are not two potential outcomes because we are not considering any of the covariates to be treatment variables. We assuming that all covariates are "fixed." In that case, we should not use words like "cause," "influence," "impact," or anything else which suggests causation. The best phrasing is in terms of "differences" between groups of units with different values for the covariate of interest. -->

### Exercise 10

<!-- XX: This is a draft. Maybe rework? -->

Write a [XX: choose causal or predictive] question which connects the outcome variable XX to a covariate of interest. 
```{r the-question-10}
question_text(NULL,
	message = "XX",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

<!-- XX: The goal is to get the student to write the question which we want. But it is OK if she doesn't! There are lots of interesting questions which one might write. Whatever she writes, here is where we give our question, which then leads into Wisdom.  -->

### Exercise 11

What is the Quantity of Interest which might help us to explore the answer to our question?

```{r the-question-11}
question_text(NULL,
	message = "XX",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

<!-- XX: In general, our question does not include any specific numbers. It just uses words. For precision, we need to specify a Quantity of Interest that we are interested in. This is harder than it might look! It also helps to set the stage of Temperance. -->

<!-- In all cases, the quantity of interest involves the outcome variable. (How could it not?) It also involves specific values of the covariates.  -->

<!-- XX: For predictive models, the specific question is generally of two types. First, what is the *expected* value of the outcome for various values of the independent variables. -->

<!-- XX: For causal models, we are almost always interested in the causal effect of treatment versus control, or, more generally, the difference between various potential outcomes. -->







## Wisdom
### 

*The only true wisdom is in knowing you know nothing.* - Socrates

### 

Our question:

> *How long do political candidates live after the election?*


### Exercise 1

In your own words, describe the key components of Wisdom for working on a data science problem. 

```{r wisdom-1}
question_text(NULL,
	message = "Wisdom requires the creation of a Preceptor Table, an examination of our data, and a determination, using the concept of validity, as to whether or not we can (reasonably!) assume that the two come from the same population.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

<!-- FIX -  -->

<!-- XX: You have the opportunity, in this and the next few questions, to drop a lot of knowledge about the data and the overall topic. Do so! But, remember, students won't read more than 2 or so sentences in a knowledge drop. -->

<!-- Not only are you discussing the data, but you are also discussing potential problems with the data, problems which will be more fully fleshed out in the Justice section. You want to pick 5 to 10 interesting facts about the data. (You may need to go to the original source, not simply relying on the chapter. ) 

It is always a good idea to knowledge drop a link to the actual data and to any articles/books/websites related to it.

You won't be drawing any conclusions or discussing the explicit violation of any assumptions. That discussion is saved until Justice and the specific questions about stability, representativeness, and (with causal models) unconfoundedness. You are, however, providing the details which you and the students can then use later. -->

### Exercise 2

Define a Preceptor Table.

```{r wisdom-2}
question_text(NULL,
	message = "A Preceptor Table is the smallest possible table of data with rows and columns such that, if there is no missing data, it is easy to calculate the quantities of interest.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### Exercise 3

Describe the key components of Preceptor Tables in general, without worrying about this specific problem.


```{r wisdom-3}
question_text(NULL,
	message = "The rows of the Preceptor Table are the units. The outcome is at least one of the columns. If the problem is causal, there will be at least two (potential) outcome columns. The other columns are covariates. If the problem is causal, at least one of the covariates will be a treatment.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### Exercise 4

Create a Github repo called `tutorial-9`. Connect it to an new R Project called `tutorial-9`. Edit the `.gitignore` file to ignore the Rproj file.

In the Console, run `tutorial.helpers::show_file(".gitignore")`. CP/CR.

```{r wisdom-4}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 5

What are the units for this problem?

HINT: Ask yourself "Who's being affected in this scenario?"

```{r wisdom-5}
question_text(NULL,
	message = "Our units for this problem would be individual candidates because the questions are about the life expectancy of those candidates.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Note also that the Preceptor Table stops with elections in 2050. So, implicitly, we have changed our question to:

<!-- SD: FIX - I don't fully agree with this question. -->

*How many years would we expect political candidates in election years between 2000 and 2050 to live?*

The question, the Preceptor Table and the data evolve together in an iterative process.

<!-- XX: A good knowledge drop for this exercise might involve other units which might be useful for related questions. For example, if the units for an presidential election are individual voters than, with a slightly different question, the units might be the 50 states. We want to show them the interplay between the exact question and which units define the Preceptor Table. -->


### Exercise 6

What is the outcome for this problem?

HINT: Ask yourself "What are we trying to get out of this problem?"

NOTE: The outcome is what WE want to get out of the data, based on our QUESTION. It does NOT concern the POSSIBLE values that we CAN extract.

```{r wisdom-6}
question_text(NULL,
	message = "The number of years a candidate lives after the election.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

<!-- FIX -  -->
<!-- XX: A good knowledge drop for this exercise might involve other outcomes which might be useful for related questions. For example, if the outcome for a presidential election are votes cast than, with a slightly different question, the outcomes might be the electoral votes. We want to show them the interplay between the exact question and which outcomes define the Preceptor Table. -->

<!-- Specifying the Preceptor Table forces us to think clearly about the units and outcomes implied by the question. The resulting discussion sometimes leads us to modify the question we started with. No data science project follows a single direction. We always backtrack. There is always dialogue. -->

<!-- SD: FIX - OLD: -->

<!-- Knowledge: Talk about the data/paper. Above. -->
<!-- SD: This is done later instead of here -->



### Exercise 7

What are some covariates which you think might be useful for this problem, regardless of whether or not they might be included in the data?

NOTE: Covariates are any variable that might have some connection with the outcome.

```{r wisdom-7}
question_text(NULL,
	message = "We will certainly need sex, with two values: “male” and “female”. Other variables that might be helpful include age at election, how close the election was, and past voting history (among others).",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The term "covariates" is used in at least three ways in data science. First, it is all the variables which might be useful, regardless of whether or not we have the data. Second, it is all the variables which we have data for. Third, it is the set of covariates which we end up using in the model.


### Exercise 8

What are the treatments, if any, for this problem?

```{r wisdom-8}
question_text(NULL,
	message = "Since this is a predictive model there is no treatment per se. Any variable which one might consider a treatment is just another covariate in this context.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Note how the paper actually uses winning the election as a non-randomly assigned treatment.

<!-- SD: FIX -  -->

<!-- XX: Again, we dialogue. Any question, or broad topic, will use words. And words are not precise! Lots of possible treatments, each different from the other, are close to the original words. Drop some knowledge, or even speculation, about what sorts of treatments might be relevant in similar problems.  -->


### Exercise 9

What moment in time does the Preceptor Table refer to? (Obviously, you should refer to the *Primer* itself when answering questions like this.)

<!-- SD: FIX - Maybe add a hint that it's unclear -->

```{r wisdom-9}
question_text(NULL,
	message = "It is unclear to what moment in time the question refers. Is it interested in all candidates who are running in the next election? All those running in the future?",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

It often gets annoying to have no clear time frame of the data given. This leads to inconsistencies between our Preceptor Table and our Data.


### Exercise 10

Describe in words the Preceptor Table for this problem.

<!-- FIX -  -->

```{r wisdom-10}
question_text(NULL,
	message = "XX. Make sure your words given an excellent description of the Preceptor Table which you are about to show the student.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

The Preceptor Table for this problem looks something like this:

```{r}
#| echo: false

tibble(ID = c("Candidate 1", "Candidate 2", "...", "Candidate 10", "Candidate 11", "...", "Candidate N"),
       lived_after = c("12", "7", "...", "10", "11", "...", "6"),
       year_elected = c("2000", "2012", "...", "2012", "2024", "...", "2050"),
       election_age = c("63", "47", "...", "52", "75", "...", "68"),
       sex = c("Female", "Male", "...", "Female", "Female", "...", "Male")) |>
  gt() |>
  tab_header(title = "Preceptor Table") |>
  cols_label(ID = md("ID"),
             lived_after = md("Years Lived After"),
             year_elected = md("Year of Election"),
             election_age = md("Age at Election"),
             sex = md("Sex")) |>
  tab_style(cell_borders(sides = "right"),
            location = cells_body(columns = c(ID))) |>
  tab_style(style = cell_text(align = "left", v_align = "middle", size = "large"), 
            locations = cells_column_labels(columns = c(ID))) |>
  cols_align(align = "center", columns = everything()) |>
  cols_align(align = "left", columns = c(ID)) |>
  fmt_markdown(columns = everything()) |>
  tab_spanner(label = "Outcome", columns = c(lived_after)) |>
  tab_spanner(label = "Covariates", columns = c(sex, year_elected, election_age))
```

Note that we can calculate anything related to longevity because we know how many years each candidate lived after an election. But, in reality, many of these candidates are still alive, so we don’t know how long they will live.

### 

Note that, like all aspects of a data science problem, the Preceptor Table evolves as we work on the problem. For example, at the start, we aren't sure what right-hand side variables will be included in the model, so we are not yet sure which columns must be in the Preceptor Table.


### Exercise 11

Write one sentence describing the data you have to answer your question.

<!-- FIX -  -->

```{r wisdom-11}
question_text(NULL,
	message = "XX",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### Exercise 12

Let's create a new `.qmd` file. Name it "Five Paramters" and save it as `five-parameters.qmd`. Render the document with `Command/Ctrl+Shift+K`. 

Run `list.files()` in the Console. CP/CR.

```{r wisdom-12}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### Exercise 13

In `five-parameters.qmd`, remove everything after the YAML Header. Then add `execute: echo: false` to the YAML Header.

In the Console, run `show_file("five-parameters.qmd")`. CP/CR.

```{r wisdom-13}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### Exercise 14

In the same file, add a new code chunk. Add `#| label: setup` and `#| message: false` to the first two lines of the chunk.

Now add the **tidyverse** and **primer.data** packages to the code chunk. Render the document.

In the Console, run `show_file("five-parameters.qmd")`. CP/CR.

```{r wisdom-14}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### Exercise 15

Finally, let's update our `.gitignore`. Open it up, and add `*_files` to the list.

In the Console, run `show_file(".gitignore", start = -5)`. CP/CR.

```{r wisdom-15}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

Commit/Push your changes to GitHub.

### Exercise 16

Now let's get to know our data. Use `head()` on `governors` in the box below.

```{r wisdom-16, exercise = TRUE}

```

```{r wisdom-16-hint-1, eval = FALSE}
head(...)
```

```{r wisdom-16-test, include = FALSE}
head(governors)
```

<!-- SD: FIX - Explain why it was better to use head() rather than summary(), etc. -->

The reason we used `head()` was to display only the first couple lines of `governors`, as we only need it to find the variables. If we plainly printed `governor`, we would be wasting rendering resources.

<!-- SD: I don't fully agree with the above -->

### 

A few things I noticed about this data:
1) The data is sorted Alphabetically by State & by Year
2) The first & last names are in separate columns
3) A lot of the data is in the past century

<!-- FIX -  -->
<!-- XX: Add code questions about EDA with your data. In particular, add at least one question about the dependent variable in the model along with one or more questions about covariates. If there is a treatment variable, you must include a question about it. -->


### Exercise 17

In your own words, define "validity" as we use the term.

```{r wisdom-17}
question_text(NULL,
	message = "Validity is the consistency, or lack thereof, in the columns of the data set and the corresponding columns in the Preceptor Table.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Is the meaning of the columns consistent, i.e., can we assume validity? That is the heart of validity. To put it simply, does the `lived_after` column in our Preceptor Table equate to same column in our data set?


### Exercise 18

Provide one reason why the assumption of validity might not hold for this problem.

<!-- FIX - Note that this section in the Primer needs some improvement -->

```{r wisdom-18}
question_text(NULL,
	message = "XX",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### Exercise 19

Summarize the state of your work so far in one or two sentences. Make reference to the data you have and to the question you are trying to answer. 


```{r wisdom-19}
question_text(NULL,
	message = "Using data from all deceased gubernatorial candidates in the United States between 1945 and 2012, we seek to forecast candidate longevity post-election.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Edit you answer as you see fit, but do not copy/paste our answer exactly. Add this summary to `five-parameters.qmd`, `Command/Ctrl + Shift + K`, and then commit/push.


## Justice
### 

*It is in justice that the ordering of society is centered.* - Aristotle


### Exercise 1

In your own words, name the four key components of Justice for working on a data science problem.

```{r justice-1}
question_text(NULL,
	message = "Justice concerns four topics: the Population Table, stability, representativeness, and unconfoundedness.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```


### Exercise 2

In your own words, define a Population Table.

```{r justice-2}
question_text(NULL,
	message = "The Population Table includes a row for each unit/time combination in the underlying population from which both the Preceptor Table and the data are drawn.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

###

We have not specified the rows for either the Preceptor Table (or the Population Table) concerning what sort of elections we are interested in. How about Senate races? Those are similar to gubernatorial elections in that they are state-wide and attract series candidates. 

But are there rows for other elections? What about mayorial elections? What about the town library committee? We need to make some choices here and, given that we only have data for gubernatorial elections, we need to be careful. Update:

> Using data from all deceased gubernatorial candidates in the United States between 1945 and 2012, we seek to forecast candidate longevity in state-wide US races post-election.

This is a change in our Preceptor Table. We are no longer interested in candiates outside the US, or those running outside of gubernatorial or Senate contests.


### Exercise 3

In your own words, define the assumption of "stability" when employed in the context of data science.

```{r justice-3}
question_text(NULL,
	message = "Stability means that the relationship between the columns in the Population Table is the same for three categories of rows: the data, the Preceptor Table, and the larger population from which both are drawn.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Lifespan changes over time. Therefore, our estimates for the future may need some adjustment — that is, to add years to our predicted life expectancy to account for a global change in lifespan over time.


### Exercise 4

Provide one reason why the assumption of stability might not be true in this case.

```{r justice-4}
question_text(NULL,
	message = "The average lifespan in 1950 is different than the average in 2020, so our lifespan in the future must be tweaked in regard to this discrepancy.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

In fact, between 1960 and 2015, life expectancy for the total population in the United States increased by almost 10 years. 

When we are confronted with this uncertainty, we can consider making our timeframe smaller.

*The longer the time period covered by the Preceptor Table (and the data), the more suspect the assumption of stability becomes.*


### Exercise 5

In your own words, define the assumption of "representativeness" when employed in the context of data science.

```{r justice-5}
question_text(NULL,
	message = "Representativeness, or the lack thereof, concerns two relationship, among the rows in the Population Table. The first is between the Preceptor Table and the other rows. The second is between our data and the other rows.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

*The more expansive your Preceptor Table, the more important the assumption of representativeness becomes.*

This data is **highly** representative of gubernatorial candidates (state officials), as it includes every candidate from 1945 to 2012. 

### Exercise 6

Provide one reason why the assumption of representativeness might not be true in this case.

```{r justice-6}
question_text(NULL,
	message = "Only the two candidates with the most votes are included in the data set. This is unfortunate, as we would ideally look at all gubernatorial candidates (regardless of votes).",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

###

Given this data-implementation, we can either:
1) change the question we are answering (restricting it to just major party candidates) or 
2) assume that major party candidates are not systematically different from all candidates.

In this tutorial, we will be assuming Option 2.


### Exercise 7

In your own words, define the assumption of "unconfoundedness" when employed in the context of data science.

```{r justice-7}
question_text(NULL,
	message = "Unconfoundedness means that the treatment assignment is independent of the potential outcomes, when we condition on pre-treatment covariates.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

This assumption is only relevant for causal models. We describe a model as "confounded" if this is not true.


### Exercise 8

Summarize the state of your work so far in two or three sentences. Make reference to the data you have and to the question you are trying to answer. Feel free to copy from your answer at the end of the Wisdom Section. Mention at least one specific problem which casts doubt on your approach. 


```{r justice-8}
question_text(NULL,
	message = "Using data from all deceased gubernatorial candidates in the United States from elections held between 1945 and 2012, we seek to forecast candidate longevity in state-wide US races post-election. There is concern that longevity for gubernatorial candidates will differ significantly from that for candidates in Senate and other state-wide elections.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

Note: Your paragraph doesn't necessarily have to be as long as mine is :)

### 

Edit the summary paragraph in `five-parameters.qmd` as you see fit, but do not copy/paste our answer exactly. `Command/Ctrl + Shift + K`, and then commit/push.

## Courage
### 

*Courage is going from failure to failure without losing enthusiasm.* - Winston Churchill


### Exercise 1

In your own words, name the key goal of Courage and the process we use to get there.

```{r courage-1}
question_text(NULL,
	message = "Courage begins with the exploration and testing of different models. It concludes with the creation of a Data Generating Mechanism.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### Exercise 2

Load the **brms** package. Load this into the Console as well, as we will be using it later in the Console.

```{r courage-2, exercise = TRUE}

```

```{r courage-2-hint-1, eval = FALSE}
library(...)
```

```{r courage-2-test, include = FALSE}
library(brms)
```

### Exercise 3

Load the **tidybayes** package.

```{r courage-3, exercise = TRUE}

```

```{r courage-3-hint-1, eval = FALSE}
library(...)
```

```{r courage-3-test, include = FALSE}
library(tidybayes)
```


### Exercise 4

Add `library(brms)` and `library(tidybayes)` to `five-parameters.qmd`. `Command/Ctrl + Shift + K`. At the Console, run:

```
tutorial.helpers::show_file("five-paramters.qmd", pattern = "brms|tidybayes")
```

CP/CR.

```{r courage-4}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

<!-- XX: For a knowledge drop, there is nothing wrong with discussion regular expressions, which is the magic which allows us to just pull out the two lines in the QMD which we want. But better would just be more Courage knowledge drops. -->


### Exercise 5

*Does sex help us to forecast longevity?*

We will be creating a model using `brm()` from the **brms** package, but first, we need to set our data. Begin by setting a new variable called `df1`, and assign it to the `governors` dataset (we skimmed this earlier). Now, pipe this to `select()` with the following arguments: `last_name, year, state, sex, lived_after, election_age`.

```{r courage-5, exercise = TRUE}

```

```{r courage-5-hint-1, eval = FALSE}
df1 <- ... |> 
  select(..., year, ..., sex, ..., election_age)
```

### Exercise 6

We will now be creating the model using `brm()` from the **brms** package. Observe the following model. 

> fit_all <- brm(data = df1,
                 formula = lived_after ~ sex*election_age,
                 silent = 2,
                 refresh = 0,
                 seed = 13)

Type `fit_all` and hit "Run Code." This generates the same results as using `print(fit_all)`.

```{r courage-6, exercise = TRUE}

```

```{r courage-6-hint-1, eval = FALSE}
fit_all
```

```{r courage-6-test, include = FALSE}
print(fit_all)
```

### 

The intercept has increased, and is around 19. This is the intercept for females. It means the average number of years lived after the election for women is 19 or so. 

**Key point:** The interpretation of the intercepts only apply to candidates who are 52-year-old females. Candidates who are not 52 years-old will have a different expected number of years to live. The interpretation of the slope applies to everyone. In other words, the relationship between 
 and 
 is the same, regardless of your gender or how old you are.

### Exercise 7

Run `family()` on `fit_all`. `family()` provides information about the "family" of the error term and the link between it and the dependent variable. 

```{r courage-7, exercise = TRUE}

```

```{r courage-7-hint-1, eval = FALSE}
family(...)
```

```{r courage-7-test, include = FALSE}
family(fit_all)
```

### 

In this case, we see that the family of the error term is Gaussian. In a Gaussian data generating mechanism, we have:
$ \text{lifespan}_i \sim \mathcal{N}(\mu, \sigma^2) $
Each governor $i$ who we sample has a certain average lifespan post-election. The value drawn is the number of years each governor lives after their term, with the distribution centered around the mean $\mu$ and spread determined by the variance $\sigma^2$. This is a common way to model continuous data like lifespans.

Also note how in our `brm()` call, we didn't specify the family as being `gaussian`. This worked because the default `family()` call in `brm()` is `gaussian`, so if we didn't specify the parameter, it would use this as the default.


### Exercise 8

Run `nobs()` on `fit_all`. The `nobs()` function returns the **n**umber of **obs**ervations.

```{r courage-8, exercise = TRUE}

```

```{r courage-8-hint-1, eval = FALSE}
nobs(...)
```

```{r courage-8-test, include = FALSE}
nobs(fit_all)
```

### 

`nobs()` is an extremely useful command that tells us the number of useful, non-error observations that we have in the data. In our case, it should have returned "1092" as its answer.


### Exercise 9

Run `formula()` on `fit_all`. `formula()` returns the statistical equation which relates the dependent variable to the independent variable(s). 

```{r courage-9, exercise = TRUE}

```

```{r courage-9-hint-1, eval = FALSE}
formula(...)
```

```{r courage-9-test, include = FALSE}
formula(fit_all)
```

### 

<!-- SD: Shouldn't this be introduced before we make the fitted model? I feel like that would make wayy more logical sense. -->

To look at interactions, we need 5 parameters, which is why we needed to wait until this chapter to introduce the concept. Here is the Mathematical Formula:

$$ lived\_after_i =  \beta_0 + \beta_1 male_i + \beta_2 c\_election\_age_i + 
\\ \beta_3 male_i *  c\_election\_age_i + \epsilon_i $$

* Our outcome variable is still $lived\_after_i$. We want to know how many years a candidate will live after an election. $male_i$ is one for male candidates and zero for female candidates. $c\_election\_age_i$ the number of years a candidate has lived before the election. In this model, we have a third predictor variable: the interaction between $male_i$ and $c\_election\_age_i$. 

* $\beta_0$ is the average number of years lived after the election for women.

* $\beta_1$ does not have a simple interpretation as a stand-alone parameter. It is a measure of how different women are from men. However, $\beta_0 + \beta_1$ has a straightforward meaning exactly analogous to the meaning of $\beta_0$. The sum is the average number of years lived after the election for *men*, who on the day of election, have been alive the average number of years of all candidates.

* $\beta_2$ is the coefficient of $c\_election\_age_i$. It it just the slope for women. It is the average difference in $lived\_after_i$ between two women, one of whom has an $c\_election\_age_i$ value of 1 greater than the other.

* $\beta_3$ alone is difficult to interpret. However, when it is added to $\beta_2$, the result in the slope for men.


### Exercise 10

Add the mathematical formula for your model to the QMD, using $\LaTeX$ math notation. When it looks good, `Command/Ctrl + Shift + K` to ensure that it works.

```
$$ lived\_after_i =  \beta_0 + \beta_1 male_i + \beta_2 c\_election\_age_i + 
\\ \beta_3 male_i *  c\_election\_age_i + \epsilon_i $$
```

Run `show_file("five-paramters.qmd", start = -5)` in the Console. CP/CR.

```{r courage-10}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

###

A key distinction when reading formulas is between:

Variables, always scripted with $i$, whose values (potentially) vary across individuals.

Parameters, never scripted with $i$, whose values are constant across individuals.

*Key point*: The interpretation of the intercepts only apply to candidates for whom $c\_election\_age_i = 0$. Candidates who are not `r round(mean(ch7_a$election_age), 0)` years-old will have a different expected number of years to live. The interpretation of the slope applies to everyone. In other words, the relationship between $lived\_after_i$ and $c\_election\_age_i$ is the same, regardless of your gender or how old you are.


### Exercise 11

Create a new code chunk in `five-parameters.qmd`. Add two code chunk options: `label: model` and `cache: true`. Copy/paste the code from above for estimating the model using `brm()` into the code chunk, assigning the result to `fit_all`.

`Command/Ctrl + Shift + K`. It may take some time to render `five-parameters.qmd`, depending on how complex your model is. But, by including `cache: true` you cause Quarto to cache the results of the chunk. The next time you render `five-parameters.qmd`, as long as you have not changed the code, Quarto will just load up the saved fitted object.

To confirm, `Command/Ctrl + Shift + K` again. It should be quick.

At the Console, run:

```
tutorial.helpers::show_file("five-parameters.qmd", start = -8)
```

CP/CR.

```{r courage-11}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### Exercise 12

Run `posterior_interval()` on `fit_all`. The `posterior_interval()` function returns 95% intervals for all the parameters in our model.

```{r courage-12, exercise = TRUE}

```

```{r courage-12-hint-1, eval = FALSE}
posterior_interval(...)
```

```{r courage-12-test, include = FALSE}
posterior_interval(fit_all)
```

### 

We are 97.5% confident that the true value of each parameter lies within its associated confidence interval. Note that we might also use the term "uncertainty interval" to describe this range.


### Exercise 13

Run `fixef()` on `fit_all`. The `fixef()` returns information about the **fix**ed **ef**fects in the model.

```{r courage-13, exercise = TRUE}

```

```{r courage-13-hint-1, eval = FALSE}
fixef(...)
```

```{r courage-13-test, include = FALSE}
fixef(fit_all)
```

### 

<!-- SD: Don't quite get the difference between fixef() and posterior_interval() -->

<!-- FIX - the following is the old, bad answer. replace. -->
<!-- With this command, we see that the predicted lifespan for females is higher than males (~16 vs ~12.5 years after term). Additionally, the female estimate has a lower estimated error rate, at ~2.91% vs ~2.93% for males. -->

<!-- SD: FIX -  -->


### Exercise 14

Run `pp_check()` on `fit_all`. The `pp_check()` runs a **p**osterior **p**redictive check.

```{r courage-14, exercise = TRUE}

```

```{r courage-14-hint-1, eval = FALSE}
pp_check(...)
```

```{r courage-14-test, include = FALSE}
pp_check(fit_all)
```

### 

Our graph in the darker blue represents our actual data. As we can see with the lighter blue graph, our fitted model is able to generate a distribution that is similar when compared to the actual data.

If the fake data had looked very different from the real data, we have had a problem. But, for the most part, we conclude that, although not perfect, pp_check() shows that the fake outcomes generated by our model are like the actual outcome data.


### Exercise 15

Use `library()` to load the [**gtsummary**](https://www.danieldsjoberg.com/gtsummary) package.

```{r courage-15, exercise = TRUE}

```

```{r courage-15-hint-1, eval = FALSE}
library(gtsummary)
```

```{r courage-15-test, include = FALSE}
library(gtsummary)
```

### 

Essentially, the `gtsummary` package is used to make more advanced tables and assist with their creation far beyond the capability of what is built-in to R.

### Exercise 16

<!-- FIX - This can be just one question or several, especially if you want to teach some more gtsummary or gt tricks. Make any adjustments to this question, like `intercept = TRUE`, so that this question works. -->

Run `tbl_regression()` on `fit_all`. 


```{r courage-16, exercise = TRUE}

```

```{r courage-16-hint-1, eval = FALSE}
tbl_regression(...)
```

```{r courage-16-test, include = FALSE}
tbl_regression(fit_all)
```

### 

<!-- SD: FIX - Old Comment: -->
<!-- DK: Give something like the same sentence which you want the students to use at the end of the next question. -->

<!-- New Comment: -->
<!-- XX: Drop some knowledge about what you have learned by looking at the resulting table. Of course, you could have learned the same thing when you first took a look at fit_XX. But the table makes it easier to see the relationships between the variables and the outcome. With luck, students will take the hint when they answer the next question. -->

<!-- https://www.danieldsjoberg.com/gtsummary/articles/tbl_regression.html -->


### Exercise 17

Write a few sentences which summarize your work so far. The first few sentences are the same as what you had at the end of the Justice Section. Add at least one sentence which describes the modelling approach which you are using, specifying at least the functional form and the dependent variable. Add at least one sentence which describes the *direction* (not the magnitude) of the relationship between one of your independent variables and your dependent variable.

```{r courage-17}
question_text(NULL,
	message = "
Using data from all deceased gubernatorial candidates in the United States from elections held between 1945 and 2012, we seek to forecast candidate longevity in state-wide US races post-election. There is concern that longevity for gubernatorial candidates will differ significantly from that for candidates in Senate and other state-wide elections. We are using a Bayesian regression model with the formula `lived_after ~ sex * election_age` to analyze the data, where `lived_after` is the dependent variable representing post-election life expectancy. The model reveals that the interaction between sex and election age has a positive direction, suggesting that as election age increases, the life expectancy difference between male and female governors tends to widen.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### Exercise 18

Update `five-parameters.qmd`. First, add `library(gtsummary)` to the `setup` code chunk. Second, add a new code chunk which creates the table of model parameters. `Command/Ctrl + Shift + K` to ensure that everything works.

At the Console, run:

```
tutorial.helpers::show_file("XX.qmd", start = -8)
```

CP/CR.

```{r courage-18}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

## Temperance
### 

*Temperance is simply a disposition of the mind which binds the passion.* - Thomas Aquinas


### Exercise 1

In your own words, describe the use of Temperance in finishing your data science project.

```{r temperance-1}
question_text(NULL,
	message = "Temperance guides us in the use of the data generating mechanism --- or the 'model' ---  we have created to answer the questions with which we began. We create posteriors for the quantities of interest.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```


### Exercise 2

What is the general topic we are investigating? What is the specific question we are trying to answer? 

```{r temperance-2}
question_text(NULL,
	message = "General topic: How long do political candidates live after the election?

Specific question: How does sex impact the number of years that a governor lives after being elected?",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Data science projects almost always begin with a broad topic of interest. Yet, in order to make progress, we need to drill down to a specific question. This leads to the creation of a data generating mechanism, which can now be used to answer lots of questions, thus allowing us to explore the original topic broadly.

### Exercise 3

To answer our question, we need to create a `newdata` object. Which variables (e.g., which columns) do we need to include in this object?

```{r temperance-3}
question_text(NULL,
	message = "We need to include two columns in our tibble - sex and election_age.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

<!-- FIX - add Knowledge Drop that describes data here -->
<!-- XX: Must be all the right hand side variables in fit_XX. And note that the type must (maybe not always . . .) match, like if `treatment` is a factor in the original data used to create fit_XX then it must (?) be a factor in ndata. -->

### Exercise 4

How many rows do we need in the `newdata` object? Recall that each row will generate a posterior for something. That is, if you have two rows in your `newdata` object, you will get two posteriors. It is up to you to determine what those two posteriors are and what you want to do with them.

```{r temperance-4}
question_text(NULL,
	message = "We need to include 2 rows in the tibble; male and female.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```


### Exercise 5

Here is the R code which creates the `newdata` object: 

```
tibble(sex = c("Male", "Female"), 
       election_age = 50)
```

Type it into the code exercise block and hit "Run Code."

```{r temperance-5, exercise = TRUE}

```

```{r temperance-5-hint-1, eval = FALSE}
tibble(... = c("Male", "..."), 
       election_age = ...)
```

```{r temperance-5-test, include = FALSE}
tibble(sex = c("Male", "Female"), 
       election_age = 50)
```

### 

When creating `newdata` objects of your own, ensure that your object covers the range of values you're interested in by specifying relevant combinations of predictors. This allows you to generate predicted outcomes for these combinations, facilitating a detailed analysis of how changes in predictors influence the dependent variable.


### Exercise 6

Behind the scenes, we have created the `ndata` object using this code. To confirm, type `ndata` and hit "Run Code."

```{r temperance-6, exercise = TRUE}

```

```{r temperance-6-hint-1, eval = FALSE}
ndata
```

```{r temperance-6-test, include = FALSE}
print(ndata)
```

### Exercise 7

Now that we have the `newdata` object, we can create a pipe which uses out fitted model to answer our question. Begin by typing `fit_all` and clicking "Run Code."

```{r temperance-7, exercise = TRUE}

```

```{r temperance-7-hint-1, eval = FALSE}
fit_all
```

```{r temperance-7-test, include = FALSE}
print(fit_all)
```

### 

<!-- FIX - Again, the main point of knowledge drops is this area is to explain to students why the newdata object looks the way it does and what it will produce. A great way to teach is via example. That is, explaining that if we had another way with these values, then we would get this posterior. Or, explaining what would be produced if we used add_epred instead of add_predict, and vice verse. -->


### Exercise 8

Pipe `fit_all` to `add_epred_draws()` with the argument `newdata = ndata`.

```{r temperance-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r temperance-8-hint-1, eval = FALSE}
... |>
  add_epred_draws(... = ndata)
```

```{r temperance-8-test, include = FALSE}
fit_all |>
  add_epred_draws(newdata = ndata)
```

### 

<!-- FIX - How do students know whether to use add_epred_draws or add_predicted_draws? This is non-trivial. On some level, we just tell them with the above command. (We don't make them guess.) But we also address this issue explicitly in various knowledge drops, especially this one. -->


### Exercise 9

Pipe this to `ggplot()`, setting aesthetics to `.epred, fill = sex`.

```{r temperance-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r temperance-9-hint-1, eval = FALSE}
... |>
  ...(aes(.epred, ... = sex))
```

```{r temperance-9-test, include = FALSE}
# ... |>
#   ggplot(aes(.epred, fill = sex))
```

### Exercise 10

Let's add `geom_histogram()` to the graph. Inside aesthetics, set `y` to `after_stat(count/sum(count))`. Then, add `alpha = 0.5`, `bins = 100`, and `position = "identity"` (note that these aren't inside aesthetics).

```{r temperance-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r temperance-10-hint-1, eval = FALSE}
... +
  geom_histogram(...(y = ...(count/...(count))),
                 alpha = ...,
                 ... = 100,
                 position = "...")
```

```{r temperance-10-test, include = FALSE}
# ... +
#   geom_histogram(aes(y = after_stat(count/sum(count))),
#                  alpha = 0.5,
#                  bins = 100,
#                  position = "identity")
```

### Exercise 11

Now add `scale_x_continuous()`, setting `labels` to `scales::number_format(accuracy = 1)`. Then add ` scale_y_continuous()`, setting `labels` to `scales::percent_format(accuracy = 1)`.

```{r temperance-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r temperance-11-hint-1, eval = FALSE}
... +
  scale_x_continuous(... = scales::number_...(accuracy = ...)) +
  ...(labels = ...::percent_format(... = 1))
```

```{r temperance-11-test, include = FALSE}
# ... +
#   scale_x_continuous(labels = scales::number_format(accuracy = 1)) +
#   scale_y_continuous(labels = scales::percent_format(accuracy = 1))
```

### 

The `scale_x_continous` (and its `y` version) modify the values on that scale (`x` or `y`).

The argument `labels = scales::percent_format()` ensures that the values are in `%` format (or number format if using `number_format()`).


### Exercise 12

Finally, add a title, subtitle, axis headings and a caption using `labs()`.

```{r temperance-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r temperance-12-hint-1, eval = FALSE}
... +
  labs(...)
```

```{r temperance-12-test, include = FALSE}
# ... +
#   labs(...)
```

Your final graph should look something like this:

```{r}
#| code-fold: true
#| code-summary: "Show the code"

fit_all |> 
  add_epred_draws(newdata = ndata) |> 
  ggplot(aes(.epred, fill = sex)) +
    geom_histogram(aes(y = after_stat(count/sum(count))),
                   alpha = 0.5, 
                   bins = 100, 
                   position = "identity") +
    scale_x_continuous(labels = 
                         scales::number_format(accuracy = 1)) +
    scale_y_continuous(labels = 
                         scales::percent_format(accuracy = 1)) +
    labs(title = "Posterior for Expected Years Lived Post-Election",
         subtitle = "Male candidates live longer",
         x = "Years",
         y = "Probability")
```

### 

The result of the graph shows that males are more likely to live longer than females, and they are most likely to live 30 years after they were elected. 

For females, note how spread out the data is, and notice how low the probability figures are for the females. This could have been due to an error in the dataset, or, more likely in this case, would have resulted from there being a lack of diversity in age in the male governors of the US.


### Exercise 13

Create a new code chunk in `five-parameters.qmd`. Label it with `#| label: plot`. Copy/paste the code which creates your graphic. `Command/Ctrl + Shift + K` to ensure that it all works as intended.

At the Console, run:

```
tutorial.helpers::show_file("XX.qmd", start = -8)
```

CP/CR.

```{r temperance-13}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### Exercise 14

Write a paragraph which summarizes the project in your own words. The first few sentences are the same as what you had at the end of the Courage Section. But, since your question may have evolved, you should feel free to change those sentences. Add at least one sentence which describes at least one quantity of interest (QoI) --- presumably one that answers your question -- and which provides a measure of uncertainty about that QoI. 

<!-- SD: FIX -  -->

<!-- XX: Most of the time, there will be some measure of uncertainty associated with your QoI. But not always! The most common counter-example involves a question which asks about the odds or probability of something happening. We would answer such a question by simulating the event with `add_predicted_draws()`. We would then calculate the odds/probability of something happening by seeing how many of the 4,000 draws met the criteria for the event. Assume that was 40%. So, we think that there is a 40% chance that event A will happen. Yet there is no uncertainty associated with that estimate because it, itself, is an expression of uncertainty. (DK: Flesh this out further.) -->

```{r temperance-14}
question_text(NULL,
	message = "You cannot edit this answer",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Edit the summary paragraph in `five-parameters.qmd` as you see fit, but do not copy/paste our answer exactly. `Command/Ctrl + Shift + K`.


<!-- XX: Again, spend time to make your recommended paragraph perfect. Study the examples in https://ppbds.github.io/primer/cardinal-virtues.html closely. -->

### Exercise 15

Write a few sentences which explain why the estimates for the quantities of interest, and the uncertainty thereof, might be wrong. Suggest an alternative estimate and confidence interval, if you think either might be warranted.

<!-- SD: FIX -  -->

```{r temperance-15}
question_text(NULL,
	message = "You cannot edit this answer",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### Exercise 16

Rearrange the material in `XX.qmd` so that the order is graphic, paragraph, math and table. Doing so, of course, requires sensible judgment. For example, the code chunk which creates the fitted model must occur before the chunk which creates the graphic. `Command/Ctrl + Shift + K` to ensure that everything works.

At the Console, run:

```
tutorial.helpers::show_file("XX.qmd")
```

CP/CR.

```{r temperance-16}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

Add `rsconnect` to the `.gitignore` file. You don't want your personal Rpubs details stored in the clear on Github. Commit/push everything.

### Exercise 17

Publish `five-parameters.qmd` to Rpubs. Choose a sensible slug. Copy/paste the url below.

```{r temperance-17}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

## Summary
### 

This tutorial covered [Chapter 9: Five Parameters](https://ppbds.github.io/primer/XX.html) of [*Preceptor’s Primer for Bayesian Data Science: Using the Cardinal Virtues for Inference*](https://ppbds.github.io/primer/) by [David Kane](https://davidkane.info/). This tutorial was created by Sanaka Dash and David Kane.



```{r download-answers, child = system.file("child_documents/download_answers.Rmd", package = "tutorial.helpers")}
```
