---
title: Five Parameters
author: David Kane and Sanaka Dash
tutorial:
  id: five-parameters
output:
  learnr::tutorial:
    progressive: yes
    'allow_skip:': yes
runtime: shiny_prerendered
description: 'Chapter 9 Tutorial: Five Parameters'
---

```{r setup, include = FALSE}
library(learnr)
library(tutorial.helpers)
library(tidyverse)
library(brms)
library(tidybayes)
library(gtsummary)
library(primer.data)

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 600, 
        tutorial.storage = "local") 
```

```{r copy-code-chunk, child = system.file("child_documents/copy_button.Rmd", package = "tutorial.helpers")}
```

```{r info-section, child = system.file("child_documents/info_section.Rmd", package = "tutorial.helpers")}
```


<!-- DK: Key problems with current version: We need (?) to flesh out the Courage and Temperance sections. Key skills to practice each time including writing math formulas in Quarto and creating nice looking tables of regression results. -->

<!-- DK: Make sure to uncomment the tests once they are ready to work. -->

<!-- DK: First pass, don't hesitate to skip knowledge drops for which you don't have something to say. -->


## Introduction
### 

This tutorial covers [Chapter 9: Five Parameters](https://ppbds.github.io/primer/XX.html) of [*Preceptor’s Primer for Bayesian Data Science: Using the Cardinal Virtues for Inference*](https://ppbds.github.io/primer/) by [David Kane](https://davidkane.info/). 

--


Let’s learn about interactions. The effect of a treatment relative to a control is almost never uniform. The effect might be bigger in women than in men, smaller in the rich relative to the poor. The technical term for such effects is “heterogeneous,” which is just Ph.D.’ese for “different.” With enough data, all effects are heterogeneous. Causal effects, at least in the social science, always vary across units. To model this reality, we rely on interactions, on allowing the effect size to differ. The same applies for predictive models. The relationship between our outcome variable and a predictor variable is rarely constant. The relationship varies based on the values of other variables. To take account of interactions, we need models with at least 5 parameters.

Follow the Cardinal Virtues and tackle each problem step by step. Remember the process: first we use Wisdom, next Justice, next Courage, and finally Temperance. Each Cardinal Virtue plays role in answering the question that we have at hand.

## Wisdom
### 

*The only true wisdom is in knowing you know nothing.* - Socrates

### Exercise 1

In your own words, describe the key components of Wisdom for working on a data science problem. (hint: read the quote!)

```{r wisdom-1}
question_text(NULL,
	message = "Wisdom requires the creation of a Preceptor Table, an examination of our data, and a determination, using the concept of validity, as to whether or not we can (reasonably!) assume that the two come from the same population. Wisdom provides the starting knowledge to initiate the process of solving the problem.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 
Consider the following question:

*How long do political candidates live after the election?*


### Exercise 2

Define a Preceptor Table.

```{r wisdom-2}
question_text(NULL,
	message = "A Preceptor Table is the smallest possible table of data with rows and columns so it's easy to calculate the quantities of interest.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

So far, simple, eh? So how does this tutorial differ from the last (and the one before that, etc.)?

### Exercise 3

Describe the key components of Preceptor Tables in general, without worrying about this specific problem.

<!-- SD: are these backslashes ['\'] required to form new lines, or will it do it automatically? -->

```{r wisdom-3}
question_text(NULL,
	message = "To create our Preceptor Table, we examine:\

Causal or predictive model: We have a predictive model since there is just one outcome: a candidate’s longevity.\

Units: Our units for this scenario would be candidates because the questions are about the life expectancy of unique candidates.\

Outcome: The number of years a candidate lives after the election.\

Treatment: Since this is a predictive model there is no treatment per se. Any variable which one might consider a treatment is just another covariate in this context.\

Covariates: We know a variety of information about each candidate.\

Moment in Time: It is unclear to what moment in time the question refers. Is it interested in all candidates who are running in next election? All those running in the future? Any candidate who has or will run between 2000 and 2050?",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

Here's our Preceptor Table:
![Preceptor Table](preceptor-table.png)
With the Preceptor Table, we can calculate anything related to longevity because we know how many years each candidate lived after an election. But, in reality, many of these candidates are still alive, so we don’t know how long they will live.

### 

### Exercise 4

What are the units for this problem?

```{r wisdom-4}
question_text(NULL,
	message = "Recall from above: *Units: Our units for this scenario would be candidates because the questions are about the life expectancy of unique candidates.*",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 5

What is/are the outcome/outcomes for this problem?

```{r wisdom-5}
question_text(NULL,
	message = "Recall from above: *Outcome: The number of years a candidate lives after the election.*",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 6

What are the covariates for this problem?

```{r wisdom-6}
question_text(NULL,
	message = "Our covariates in this scenario would be 'Year of Election' and 'Age at Election' {as labelled in the Preceptor Table if you would read, but sadly, you don't :( }",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 7

What are the treatments, if any, for this problem?

```{r wisdom-7}
question_text(NULL,
	message = "Recall from above: *Treatment: Since this is a predictive model there is no treatment per se. Any variable which one might consider a treatment is just another covariate in this context.* You know, maybe you should refer back to that initial answer instead of relying on ChatGPT for your answers to these questions.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 8

What moment in time does the Preceptor Table refer to?

```{r wisdom-8}
question_text(NULL,
	message = "recall from above (again): *Moment in Time: It is unclear to what moment in time the question refers. Is it interested in all candidates who are running in next election? All those running in the future? Any candidate who has or will run between 2000 and 2050?*",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

<!-- DK: Next three questions are only included for a causal model. - DONE -->
<!-- SD: Removed those questions because this refers to a predictive model. -->

### 

<!-- DK: End causal model section. If there is not one, you will need to run Format Tutorial Chunk Labels in order to renumber the exercises once you delete these. - DONE -->

### Exercise 9

<!-- DK: It is a feature that this question almost forces students to go to the chapter and read about the data. -->

Write one sentence describing the data you have to answer your question.

```{r wisdom-9}
question_text(NULL,
	message = "Is your answer really correct? You decide.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 10

Load the **tidyverse** package, as well as the **primer.data** package, which includes the `governors` dataset. On the third line, use `head()` on `governors`.

```{r wisdom-10, exercise = TRUE}

```

```{r wisdom-10-hint-1, eval = FALSE}
library(...)
library(...)
head(...)
```

```{r wisdom-10-test, include = FALSE}
library(tidyverse)
library(primer.data)
head(governors)
```

The reason we used `head()` was to display only the first couple lines of `governors`, as we only need it to find the variables. If we plainly printed `governor`, we would be wasting rendering resources.

### 

<!-- XX: Insert comments about the data. -->

<!-- DK: Load any other packages that are needed. (But make sure that they are also included in the setup chunk.) But save brms and tidybayes for the Courage section. - DONE -->
<!-- SD: Added the `primer.data` package due to it containing our data. -->

<!-- DK: Consider adding more questions about EDA with this data. In particular, add at least one question about the dependent variable in the model along with one or more questions about covariates. If there is a treatment variable, we must include a question about it. -->

<!-- Variable questions come in two types. First there are questions which require the student to run, say, summary() on the variable. Then, knowledge about the variable can be dropped. Second, there are questions which ask for a one sentence summary about the variable, something which could be used in our summary of the project. -->

### Exercise 11

In your own words, define "validity" as we use the term.

```{r wisdom-11}
question_text(NULL,
	message = "Validity is the consistency, or lack thereof, in the columns of the data set and the corresponding columns in the Preceptor Table.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

Is the meaning of the columns consistent, i.e., can we assume validity? That is the heart of validity. To put it simply, does the `lived_after` column in our Preceptor Table equate to same column in our data set?

### Exercise 12

What can't we do if the assumption of validity is not true?

```{r wisdom-12}
question_text(NULL,
	message = "We can't combine the Preceptor Table and the data in order to construct the Population Table.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 13

Provide one reason why the assumption of validity might hold for this problem.

```{r wisdom-13}
question_text(NULL,
	message = "The only way to know if you were right is to check the corresponding section in the Primer. Too lazy? Looks like someone doesn't want to learn Data Science.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 14

<!-- DK: In creating your own answer to questions like this, check with the chapter. One might already be provided! If not, it is often useful to revisit the relevant section of the Key Concepts chapter in the Primer. -->

<!-- Example: *Using data from a 2012 survey of Boston-area commuters, we seek to understand the relationship between income and political ideology in Chicago and similar cities in 2020. In particular, what percentage of individuals who make more than $100,000 per year are liberal?* -->

Summarize the state of your work so far in one or two sentences. Make reference to the data you have and to the question you are trying to answer. 


```{r wisdom-14}
question_text(NULL,
	message = "Fine, I'll give it to you: *Using data from all deceased gubernatorial candidates in the United States between 1945 and 2012, we seek to forecast candidate longevity post-election.*",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

## Justice
### 


*It is in justice that the ordering of society is centered.* - Aristotle


### Exercise 1

In your own words, name the four key components of Justice for working on a data science problem. Stuck? It's literally in the Primer if you would check.

```{r justice-1}
question_text(NULL,
	message = "Justice concerns four topics: the Population Table, stability, representativeness, and unconfoundedness.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 2

In your own words, define a Population Table.

```{r justice-2}
question_text(NULL,
	message = "The Population Table is a structure which includes a row for every unit in the population. We generally break the rows in the Population Table into three categories: the data for units we have (the actual data set), the data for units which we actually want to have (the Preceptor Table), and the data for units we do not care about (the rest of the population, not included in the data or the Preceptor Table).",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 3

In your own words, define the assumption of "stability" when employed in the context of data science.

```{r justice-3}
question_text(NULL,
	message = "Stability means that the relationship between the columns in the Population Table is the same for three categories of rows: the data, the Preceptor Table, and the larger population from which both are drawn.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

*The longer the time period covered by the Preceptor Table (and the data), the more suspect the assumption of stability becomes.*

### Exercise 4

Provide one reason why the assumption of stability might not be true in this case.

```{r justice-4}
question_text(NULL,
	message = "Read the top sentence (in Italics). This is one example of why stability might not be true in this case.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 5

In your own words, define the assumption of "representativeness" when employed in the context of data science.

```{r justice-5}
question_text(NULL,
	message = "Representativeness, or the lack thereof, concerns two relationship, among the rows in the Population Table. The first is between the Preceptor Table and the other rows. The second is between our data and the other rows.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

*The more expansive your Preceptor Table, the more important the assumption of representativeness becomes.*

### Exercise 6

Provide one reason why the assumption of representativeness might not be true in this case.

```{r justice-6}
question_text(NULL,
	message = "Only the two candidates with the most votes are included in the data set. This is unfortunate, as we would ideally look at all gubernatorial candidates (regardless of votes).",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 7

In your own words, define the assumption of "unconfoundedness" when employed in the context of data science.

```{r justice-7}
question_text(NULL,
	message = "Unconfoundedness means that the treatment assignment is independent of the potential outcomes, when we condition on pre-treatment covariates.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

This assumption is only relevant for causal models. We describe a model as "confounded" if this is not true.


### Exercise 8

Summarize the state of your work so far in two or three sentences. Make reference to the data you have and to the question you are trying to answer. Feel free to copy from your answer at the end of the Wisdom Section. Mention at least one specific problem which casts doubt on your approach. 


```{r justice-8}
question_text(NULL,
	message = "Using data from all deceased gubernatorial candidates in the United States from elections held between 1945 and 2012, we seek to forecast candidate longevity in state-wide US races post-election. There is concern that longevity for gubernatorial candidates will differ significantly from that for candidates in Senate and other state-wide elections.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

## Courage
### 

*Courage is going from failure to failure without losing enthusiasm.* - Winston Churchill


<!-- Questions about models, tests, and the DGM. -->


### Exercise 1

<!-- DK: Not sure I like this answer. -->

In your own words, name the key goal of Courage and the process we use to get there.

```{r courage-1}
question_text(NULL,
	message = "Courage selects the data generating mechanism. We first specify the mathematical formula which connects the outcome variable we are interested in with the other data that we have. We explore different models. We need to decide which variables to include and to estimate the values of unknown parameters. We check our models for consistency with the data we have. We avoid hypothesis tests. We select one model.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 2

Load the **brms** package. Remember, this should also be done in the console.

```{r courage-2, exercise = TRUE}

```

```{r courage-2-hint-1, eval = FALSE}
library(...)
```

```{r courage-2-test, include = FALSE}
library(brms)
```

### 

Without going too deep into specifics, the `brms` package helps in creating wide range of complex Bayesian models.

### Exercise 3

Load the **tidybayes** package.

```{r courage-3, exercise = TRUE}

```

```{r courage-3-hint-1, eval = FALSE}
library(...)
```

```{r courage-3-test, include = FALSE}
library(tidybayes)
```

### 

<!-- XX: Some comments about this problem. -->

<!-- XX: Might need an exercise which gets/creates/cleans the data you need for fitting the model. -->

### Exercise 4

<!-- SD: This Exercise is unfinished. Seeking help from Preceptor -->

*Does sex help us to forecast longevity?*

Create a model using `brm()` from the **brms** package (search `?brm` to learn how to use this). Your arguments should be `. 

Assign the result to an object called `fit_sex`.

<!-- Don't forget to create this model yourself in the setup chunk. Do this once, save the object, comment out that code and then just read_rds to create the object for his tutorial. -->

<!-- Depending on code speed, you can run this function multiple times, without assigning the return value, looking at the printout, and seeing how things change. -->

```{r courage-4, exercise = TRUE}

```

```{r courage-4-hint-1, eval = FALSE}

```

### 

### Exercise 5

Type `fit_sex` and hit "Run Code." This generates the same results as using `print(fit_sex)`.


```{r courage-5, exercise = TRUE}

```

```{r courage-5-hint-1, eval = FALSE}
print(...)
```

```{r courage-5-test, include = FALSE}
# print(fit_sex)
```

### 

<!-- XX Same some general words about the object. Note that we are about to go through the top 4 rows. -->

<!-- Add summary() Exercise if it gives a different answer -->

### Exercise 6

Run `family()` on `fit_sex`. `family()` provides information about the "family" of the error term and the link between it and the dependent variable. 

```{r courage-6, exercise = TRUE}

```

```{r courage-6-hint-1, eval = FALSE}
family(...)
```

```{r courage-6-test, include = FALSE}
# family(fit_sex)
```

### 

<!-- DK: This is a great location for explanations which get much more detailed in later chapters. -->

In this case, XX . . .

### Exercise 7

Run `formula()` on `fit_sex`. `formula()` returns the statistical equation which relates the dependent variable to the independent variable(s). 

```{r courage-7, exercise = TRUE}

```

```{r courage-7-hint-1, eval = FALSE}
formula(...)
```

```{r courage-7-test, include = FALSE}
# formula(fit_sex)
```

### 

In this case, XX . . .

### Exercise 8

Run `nobs()` on `fit_sex`. The `nobs()` function returns the **n**umber of **obs**ervations.

```{r courage-8, exercise = TRUE}

```

```{r courage-8-hint-1, eval = FALSE}
nobs(...)
```

```{r courage-8-test, include = FALSE}
# nobs(fit_sex)
```

### 

In this case, XX

### Exercise 9

Run `posterior_interval()` on `fit_sex`. The `posterior_interval()` function returns 95% intervals for all the parameters in our model.

```{r courage-9, exercise = TRUE}

```

```{r courage-9-hint-1, eval = FALSE}
posterior_interval(...)
```

```{r courage-9-test, include = FALSE}
# posterior_interval(fit_sex)
```

### 

In this case, XX


### Exercise 10

Run `fixef()` on `fit_sex`. The `fixef()` returns information about the **fix**ed **ef**fects in the model.

```{r courage-10, exercise = TRUE}

```

```{r courage-10-hint-1, eval = FALSE}
fixef(...)
```

```{r courage-10-test, include = FALSE}
# fixef(fit_sex)
```

### 

In this case, XX

<!-- DK: Consider adding questions about conditional_effects(), ranef() and other commands, if relevant. -->

### Exercise 11

Run `pp_check()` on `fit_sex`. The `pp_check()` runs a **p**osterior **p**redictive check.

```{r courage-11, exercise = TRUE}

```

```{r courage-11-hint-1, eval = FALSE}
pp_check(...)
```

```{r courage-11-test, include = FALSE}
# pp_check(fit_sex)
```

### 

In this case, XX

<!-- If the fake data had looked very different from the real data, we have had a problem. But, for the most part, we conclude that, although not perfect, pp_check() shows that the fake outcomes generated by our model are like the actual outcome data. -->


### Exercise 12

Use `library()` to load the [**gtsummary**](https://www.danieldsjoberg.com/gtsummary) package.

```{r courage-12, exercise = TRUE}

```

```{r courage-12-hint-1, eval = FALSE}
library(gtsummary)
```

```{r courage-12-test, include = FALSE}
library(gtsummary)
```

### 

<!-- Drop some knowledge about gtsummary. Or say something more about your DGM. - DONE -->
Essentially, the `gtsummary` package is used to make more advanced tables and assist with their creation far beyond the capability of what is built-in to R.

### Exercise 13

<!-- DK: This can be just one question or several, especially if you want to teach some more gtsummary or gt tricks. Note that you need to adjust the test to make sure it works. -->

Run `tbl_regression()` on `fit_sex`. 


```{r courage-13, exercise = TRUE}

```

```{r courage-13-hint-1, eval = FALSE}
tbl_regression(...)
```

```{r courage-13-test, include = FALSE}
# tbl_regression(fit_sex)
```

### 

<!-- DK: Give something like the same sentence which you want the students to use at the end of the next question. -->


### Exercise 14

Write a few sentence which summarize your work so far. The first few sentences are the same as what you had at the end of the Justice Section. Add at least one sentence which describes the modelling approach which you are using, specifying at least the functional form and the dependent variable. Add at least one sentence which describes the *direction* (not the magnitude) of the relationship between one of your independent variables and your dependent variable.

```{r courage-14}
question_text(NULL,
	message = "XX",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

## Temperance
### 

*Temperance is simply a disposition of the mind which binds the passion.* - Thomas Aquinas


### Exercise 1

In your own words, describe the use of Temperance in finishing your data science project.

```{r temperance-1}
question_text(NULL,
	message = "Temperance guides us in the use of the data generating mechanism --- or the 'model' ---  we have created to answer the questions with which we began. We create posteriors for the quantities of interest.",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 2

<!-- SD: Again, I need help with this graph -->

Recall the question with which we began:

*How many years would we expect two gubernatorial candidates — one male and one female, both 10 years older than the average candidate — to live after the election?*

Pipe `fit_all` to `add_epred_draws(newdata = newobs)`

```{r temperance-2, exercise = TRUE}

```

```{r temperance-2-hint-1, eval = FALSE}

```

```{r temperance-2-test, include = FALSE}

```

### 

### Exercise 3

Write a paragraph which summarizes the project in your own words. The first few sentences are the same as what you had at the end of the Courage Section. But, since your question may have evolved, you should feel free to change those sentences. Add at least one sentence which describes at least one quantity of interest (QoI) --- presumably one that answers your question -- and which provides a measure of uncertainty about that QoI. 

```{r temperance-3}
question_text(NULL,
	message = "You cannot edit this answer",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

### Exercise 4

Write a few sentences which explain why the estimates for the quantities of interest, and the uncertainty thereof, might be wrong. Suggest an alternative estimate and confidence interval.

```{r temperance-4}
question_text(NULL,
	message = "You cannot edit this answer",
	answer(NULL, correct = TRUE),
	allow_retry = FALSE,
	incorrect = NULL,
	rows = 6)
```

### 

## Summary
### 

This tutorial covered [Chapter 9: Five Parameters](https://ppbds.github.io/primer/XX.html) of [*Preceptor’s Primer for Bayesian Data Science: Using the Cardinal Virtues for Inference*](https://ppbds.github.io/primer/) by [David Kane](https://davidkane.info/). This tutorial was created by Sanaka Dash and David Kane.



```{r download-answers, child = system.file("child_documents/download_answers.Rmd", package = "tutorial.helpers")}
```
