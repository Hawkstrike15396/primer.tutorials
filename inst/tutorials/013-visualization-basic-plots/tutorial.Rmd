---
title: 'Visualization: Basic Plots'
author: Kevin Xu
tutorial:
  id: visualization-basic-plots
output:
  learnr::tutorial:
    progressive: yes
    allow_skip: yes
runtime: shiny_prerendered
description: Simple tidyverse introduction and an overview of basic plots.
---

<!-- Tutorial should take about 90 minutes. -->
<!-- Download: RDS or HTML? -->

```{r setup, include = FALSE}
library(learnr)
library(all.primer.tutorials)
library(tidyverse)
library(primer.data)
library(lubridate)

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local") 

globe_temps <- temperature |> 
  filter(area == "globe") |> 
  select(date, temperature)

savings <- economics |> 
  select(date, psavert)

usbmi <- nhanes |> 
  select(bmi) |>
  drop_na()
```

```{r copy-code-chunk, child = system.file("child_documents/copy_button.Rmd", package = "tutorial.helpers")}
```

```{r info-section, child = system.file("child_documents/info_section.Rmd", package = "tutorial.helpers")}
```

<!-- Collection of links which should appear in knowledge drops somewhere in this group of visualization tutorials: -->

<!-- https://rkabacoff.github.io/datavis/ -->


## Introduction
### 

This tutorial will walk you through some of the fundamental types of plots found in the **[ggplot2](https://ggplot2.tidyverse.org)** package, including scatter plots, line plots and histograms.

## `geom_smooth()`
### 

We can add straight or smoothed lines which follow the path of our data using `geom_smooth()`.

Let's create the following plot with the `savings` dataset.

```{r make-smooth-p}
smooth_p <- savings |>  
  ggplot(aes(x = date, y = psavert)) +
    geom_point() +
    geom_smooth(method = 'loess', formula = 'y ~ x', se = FALSE) +
  labs(title = "U.S. Personal Savings Rate",
       subtitle = "Savings rate increased in the past decade",
       x = "Year",
       y = "Percent disposable personal income saved",
       caption = "U.S. Bureau of Economic Analysis (2021)")
smooth_p
```

### Exercise 1

Let's first explore the `savings` dataset using `glimpse()`.

```{r geomsmooth-1, exercise = TRUE}

```

```{r geomsmooth-1-hint-1, eval = FALSE}
glimpse(...)
```

### 

The personal savings rate, represented here under the variable `psavert`, is calculated as a percentage of disposable personal income (DPI).

### Exercise 2

Within `ggplot()` set `data` to `savings`

```{r geomsmooth-2, exercise = TRUE}

```

```{r geomsmooth-2-hint-1, eval = FALSE}
ggplot(data = ...)
```

### 

`ggplot()` initializes a ggplot object. Your output should be an empty canvas.


### Exercise 3

Now, specify the **aes**thetic inside `ggplot()` for the x-axis to be the `date` and the y-axis to be `psavert`. 

```{r geomsmooth-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r geomsmooth-3-hint-1, eval = FALSE}
ggplot(data = savings,
       aes(x = ..., y = ...))
```

### 

Your output should still be empty, since we have not yet added a `geom_*` layer.

### Exercise 4

Add `geom_point()` to the layer.

```{r geomsmooth-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r geomsmooth-4-hint-1, eval = FALSE}
ggplot(data = savings,
       aes(x = date, y = psavert)) +
  geom_point()
```

### 

When points on the graphs start becoming too dense, two ways to combat this is to adjust the `alpha` value or making the `shape` a smaller value.

### Exercise 5

The plot so far looks neat, but a trend line would be helpful in identifying trends across many years. Add the layer `geom_smooth()`.

```{r geomsmooth-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r geomsmooth-5-hint-1, eval = FALSE}
ggplot(data = savings,
       aes(x = date, y = psavert)) +
  geom_point() +
  geom_smooth()
```

### 

Nice! The blue line represents our regression line, and the shaded area around it is the standard error, or what is essentially the margin of error.

### Exercise 6

Notice the warning message R gives us? Let's try setting the `method` to `"loess"` inside `geom_smooth()`.

```{r geomsmooth-6, exercise = TRUE, warning = FALSE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomsmooth-6-hint-1, eval = FALSE}
Remember to put "loess" in quotes within geom_smooth()
```

```{r geomsmooth-6-hint-2, eval = FALSE}
... +
  geom_smooth(method = "...")
```

### 

If you do not specify a method, R will give you a warning that it has made some assumptions in the function. `"loess"` is short for **LO**cal regr**ESS**ion, giving us the curved line.

### Exercise 7

Great! But, we still get a message! Set the `formula` argument within `geom_smooth()` to `y ~ x`.

```{r geomsmooth-7, exercise = TRUE}


```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomsmooth-7-hint-1, eval = FALSE}
ggplot(data = savings, 
       mapping = aes(x = date, 
                     y = psavert)) +
  geom_point()  +
    geom_smooth(method = "loess", formula = y ~ x)
```

### 

If you do not specify `formula`, R will also give you a warning that you have not done so. By default, the formula to use in smoothing function is set to `y ~ x`.

### Exercise 8

Also set `se` to `FALSE` to get rid of the grey area surrounding the trend line.

```{r geomsmooth-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r geomsmooth-8-hint-1, eval = FALSE}
ggplot(data = savings, 
       mapping = aes(x = date, 
                     y = psavert)) +
  geom_point()  +
    geom_smooth(method = "loess", formula = y ~ x, se = FALSE)
```

### 

Setting the `se` parameter determines whether or not to display the confidence interval around smooth. By default it's set to `TRUE`.

### Exercise 9

Now use `labs()` to set an appropriate title, subtitle, axes labels, and caption for the graph.

```{r geomsmooth-9, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomsmooth-9-hint-1, eval = FALSE}
... +
  labs(title = "...",
       subtitle = "..."
       x = "...",
       y = "...",
       caption = "...")
```

Reminder: Your graph should look like this.

```{r show-smooth-p}
smooth_p
```

### 

Good work! The parameters used here may not always be the best choice. Check out this function's (documentation page)[https://ggplot2.tidyverse.org/reference/geom_smooth.html] to learn more about the other arguments for `method` and `formula`.

## `geom_line()`
### 

A line graph is a plot that visualizes the relationship between two numerical variables when there is a sequential nature to the variable on the x-axis, also called the independent variable.

Let's create the following line graph via the `globe_temps` dataset,

```{r make-line-p}
globe_temps_p <- globe_temps |> 
  ggplot(aes(x = date, y = temperature)) +
    geom_line() +
    geom_smooth(method = "loess", formula = y ~ x, se = FALSE) +
    labs(title = "Global Monthly Temperature (°C) Deviations",
         subtitle = "Temperature deviations trend upward",
         x = "Year",
         y = "Global Average Deviation (°C)")

globe_temps_p
```

### 

This dataset used satellite-measured data to calculate global monthly temperature changes. The values show monthly temperature deviations in °C relative to their respective 1991-2021 average temperature.

### Exercise 1

Let's first explore the `globe_temps` dataset. Use the `summary()` function.

```{r geomline-1, exercise = TRUE}

```

```{r geomline-1-hint-1, eval = FALSE}
summary(...)
```

### 

`summary()` is a function that returns various statistical measurements for each variable.

The ISO 8601 standard is the convention for date-time formatting. Dates are represented in the format YYYY-MM-DD, as seen in the `date` observations in the `globe_temps` dataset.

### Exercise 2

Within `ggplot()` set `data` to `globe_temps`.

```{r geomline-2, exercise = TRUE}

```

```{r geomline-2-hint-1, eval = FALSE}
ggplot(data = ...)
```

### 

Setting the `data` argument binds the `ggplot` object to the specified dataset.

### Exercise 3

Within `ggplot()`, now set the argument `mapping` to equal `aes()`. Within `aes()`, map `date` to the x-axis and `temperature` to the y-axis.

```{r geomline-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r geomline-3-hint-1, eval = FALSE}
ggplot(data = `globe_temps`, 
       aes(x = ..., y = ...))
```

### 

Because time is an inherently sequential value, it will often be the independent variable in line graphs.

### Exercise 4

Now add a call to the `geom_line()` function.

```{r geomline-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r geomline-4-hint-1, eval = FALSE}
ggplot(data = `globe_temps`, 
       aes(x = date, y = temperature)) + 
  ...
```

### 

Congratulations on your first line plot! This graph could stand on its own, but a trend line could be helpful to us here.

### Exercise 5

Now add a call to the `geom_smooth()` function. 

```{r geomline-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r geomline-5-hint-1, eval = FALSE}
ggplot(data = `globe_temps`, 
       aes(x = date, y = temperature)) + 
  geom_line() +
  ...
```

### 

Like in the previous section, notice the warning message in the R Console window because we didn't specify certain parameters.

### Exercise 6

Set the `method` parameter to `"loess"`, `formula` to `y ~ x`, and `se` to `FALSE`.

```{r geomline-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r geomline-6-hint-1, eval = FALSE}
ggplot(data = `globe_temps`, 
       aes(x = date, y = temperature)) + 
  geom_line() +
  geom_smooth(method = "loess", 
              formula = y ~ x, 
              se = FALSE)
```

### 

For relatively smaller datasets, `method` by default, is set to `"loess"`. For datasets larger than 1,000 observations, `method` is set to another technique, `"gam"`. 

### Exercise 7

Now use `labs()` to set an appropriate title, subtitle, axes labels, and caption for the graph.

```{r geomline-7, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomline-7-hint-1, eval = FALSE}
... +
  labs(title = "...",
       subtitle = "..."
       x = "...",
       y = "...",
       caption = "...")
```

Reminder: This is what our graph should look like.

```{r show-line-p}
globe_temps_p
```

### 

Nice job! This is the most fundamental line graph, `geom_line()` has many additional arguments (e.g. `linetype` or `color`). Connected observations can also be visualized using `geom_step()`, `geom_path()`, `geom_line()`, `geom_ribbon`.

## `geom_histogram()`
### 

A histogram is a plot that visualizes the distribution of a numerical variable with bars.

### 

Let's create the following histogram via the `usbmi` dataset.

```{r make-hist-p}
hist_p <- ggplot(data = usbmi, aes(x = bmi)) +
    geom_histogram(binwidth = 1,
                   color = "white") +
    labs(title = "BMI of Americans",
         subtitle = "Significant number of Americans are overweight or obese",
         x = "Body Mass Index",
         y = "Count")
hist_p
```

### Exercise 1

As always, let's first explore the data. Run `summary(usbmi)`.

```{r geomhistogram-1, exercise = TRUE}

```

### 

If the mean, median and the mode of a set of numbers are equal, it means, the distribution is symmetric. Otherwise, it is characterized as asymmetric.

<!-- VD: This should be elaborated upon a bit -->

### Exercise 2

Within `ggplot()`, set `data` to `usbmi`.

```{r geomhistogram-2, exercise = TRUE}

```

```{r geomhistogram-2-hint-1, eval = FALSE}
ggplot(data = ...)
```

### 

The `data` argument for `ggplot()` requires the object to be of type `data.fram`. If not, as with `usbmi`, the dataset will be converted to one by `fortify()`.

### Exercise 3

Now, map `bmi` to the x-axis since we want to see the distribution of BMI scores.

```{r geomhistogram-3, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomhistogram-3-hint-1, eval = FALSE}
ggplot(data = ..., 
       mapping = aes(x = ...))
```

### Exercise 4

Let's now add the layer `geom_histogram()`.

```{r geomhistogram-4, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomhistogram-4-hint-1, eval = FALSE}
Remember when you add a layer you use +. 
```

```{r geomhistogram-4-hint-2, eval = FALSE}
ggplot(data = ..., 
       mapping = aes(x = ...)) +
  geom_histogram()
```

### 

`geom_histogram()` has a default y-axis which is the **count** for the number of observations that fall into a particular bin of the x-axis variable.

### Exercise 5

Specify the width of bins to be 1 using the `binwidth` argument in `geom_histogram()`.

```{r geomhistogram-5, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomhistogram-5-hint-1, eval = FALSE}
ggplot(data = usbmi, 
       mapping = aes(x = bmi)) +
  geom_histogram(binwidth = ...)
```

### 

Another way to set the number of bins is to specify the `bins` argument to this desired numerical value.

### Exercise 6

Add white vertical borders demarcating the bins by setting the argument `color` to `"white"` within `geom_histogram()`.

```{r geomhistogram-6, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomhistogram-6-hint-1, eval = FALSE}
ggplot(data = usbmi, 
       mapping = aes(x = bmi)) +
  geom_histogram(binwidth = 1,
                 color = ...)
```

### 

For plots that are not points or lines, the argument `color` only changes the outline. 

### Exercise 7

Now use `labs()` to set an appropriate title, subtitle, axes labels, and caption for the graph.

```{r geomhistogram-7, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomhistogram-7-hint-1, eval = FALSE}
... +
  labs(title = "...",
       subtitle = "..."
       x = "...",
       y = "...",
       caption = "...")
```

Reminder: This is what our graph should look like.

```{r show-hist-p}
hist_p
```

### 

Histograms display the counts with bars. To display counts with lines, you would use `geom_freqpoly()`. 

## `geom_density()`
### 

`geom_density()` is used to make a density plot, a smoothed version of a histogram. 

### 

Let's create the following density plot using the `cces` dataset.

```{r make-dens-p}
dens_p <- ggplot(data = cces, 
                 mapping = aes(x = age, 
                               color = ideology, 
                               fill = ideology)) +
  geom_density(alpha = .1) +
  labs(title = " Distribution of Age by Ideology", 
       subtitle = "Most young people are not sure of their ideology",
       x = "Age", 
       y = "Density",
       caption = "Kuriwaki (2020)")

dens_p
```

### Exercise 1

Let's first explore the data. Run `str(cces)`. Given the plot above, can you find the two variables that would help us to identifying the age and ideology of a respondent?

```{r geomdensity-1, exercise = TRUE}

```

### Exercise 2

Use the `cces` data set in the `primer.data` package. Within `ggplot()`, set `data` to `cces`.

```{r geomdensity-2, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomdensity-2-hint-1, eval = FALSE}
ggplot(data = ...)
```

### 

ggplot() initializes a ggplot object. Your output should be an empty canvas.

### Exercise 3

Let's now map the variable `age` to the `x` argument inside `aes()`.

```{r geomdensity-3, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomdensity-3-hint-1, eval = FALSE}
ggplot(data = cces, 
       mapping = aes(x = ...))
```

### Exercise 4

Let's now add the layer `geom_density()`

```{r geomdensity-4, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomdensity-4-hint-1, eval = FALSE}
ggplot(data = cces, 
       mapping = aes(x = ...)) +
  geom_density()
```

### 

This plot displays a density distribution for all ideologies by age. We will split this distribution by ideology next.

### Exercise 5

Now within `aes`, set `color` and `fill` equal to the variable `ideology`.

```{r geomdensity-5, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomdensity-5-hint-1, eval = FALSE}
ggplot(data = cces, 
       mapping = aes(x = ..., 
                     color = ..., 
                     fill = ...)) + 
  geom_density()
```

### 

We are getting closer! Right now, the distributions of one ideology are covering others because their `fill` is 100% opaque.

### Exercise 6

Now set the `alpha` argument in `geom_density()` to 0.1.

```{r geomdensity-6, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomdensity-6-hint-1, eval = FALSE}
... + 
  geom_density(alpha = 0.1)
```

### Exercise 7

Finally set an appropriate title, subtitle, axes labels, and caption for the graph.

```{r geomdensity-7, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geomdensity-7-hint-1, eval = FALSE}
... +
  labs(title = "...",
       subtitle = "..."
       x = "...",
       y = "...",
       caption = "...")
```

Reminder: Your graph should look something like this.

```{r show-dens-p}
dens_p
```

### 

Good work! Similar plots that you could look into include `geom_freqpoly()` and `geom_violin()`.

## `geom_bar()`
### 

A barplot is a plot that visualizes the distribution of a categorical variable.

### 

Let's create the following barplot using the `trains` dataset.

```{r make-bar-p}
bar_p <- ggplot(data = trains, 
       mapping = aes(x = treatment, 
                     fill = party)) +
  geom_bar(position = "dodge") +
  labs(title = "Democrats and Republicans in Treated and Control Groups",
       subtitle = "Few Republicans in both treated and control groups", 
       x = "Treatment", 
       y = "Count",
       caption = "Enos(2014)")

bar_p
```

### Exercise 1

Let's first explore the data. Run `str(trains)`. 

```{r geombar-1, exercise = TRUE}

```

### Exercise 2

Use the `trains` data set in the `primer.data` package. Within `ggplot()`, set `data` to `trains`.

```{r geombar-2, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geombar-2-hint-1, eval = FALSE}
ggplot(data = ...)
```

### 

ggplot() initializes a ggplot object. Your output should be an empty canvas.

### Exercise 3

Let's now map the variable `treatment` to the `x`argument inside `aes()`.

```{r geombar-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">

```{r geombar-3-hint-1, eval = FALSE}
ggplot(data = trains, 
       mapping = aes(x = ...))
```

### Exercise 4

Let's now add the layer `geom_bar()`

```{r geombar-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">

```{r geombar-4-hint-1, eval = FALSE}
ggplot(data = trains, 
       mapping = aes(x = ...)) +
  geom_bar()
```

### 

This plot breaks down the count of the study by treatment group, does not split these groups by party. We will do this next.

### Exercise 5

Let's now also map the variable `party` to the `fill` argument.

```{r geombar-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">

```{r geombar-5-hint-1, eval = FALSE}
ggplot(data = trains, 
       mapping = aes(x = treatment, 
                     fill = ...)) +
  geom_bar()
```

### 

We use the `fill` argument instead of the `color` argument because we want to color the interior of the shape but not its borders.

Now, we can see the composition of each treatment group by party. Notice that the party bars are stacked.

### Exercise 6

Let's make our graph a side-by-side barplot. Set `position` to `"dodge"` in `geom_bar()`.

```{r geombar-6, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geombar-6-hint-1, eval = FALSE}
ggplot(data = trains, 
       mapping = aes(x = treatment, 
                     fill = party)) +
  geom_bar(position = ...)
```

### 

By default `position` is set to `"stack"`. `"dodge"` puts different colors side by side.

### Exercise 7

Now use `labs()` to set an appropriate title, subtitle, axes labels, and caption for the graph.

```{r geombar-7, exercise = TRUE}

```

<button onclick="transfer_code(this)">Copy previous code</button>

```{r geombar-7-hint-1, eval = FALSE}
... +
  labs(title = "...",
       subtitle = "..."
       x = "...",
       y = "...",
       caption = "...")
```

Reminder: This is what our graph should look like.

```{r show-bar-p}
bar_p
```

### 

Good work! You created your first graph using `geom_bar()`. `geom_col()` is a similar function where instead, the dataset specifies the height of each bar.

## Summary
### 

Awesome, you've just finished your first tutorial on visualizing data!  The framework you used to create and organize the components of each plot are built using The Grammar of Graphics, first introduced by Leland Wilkison in 2005.



```{r download-answers, child = system.file("child_documents/download_answers.Rmd", package = "tutorial.helpers")}
```
