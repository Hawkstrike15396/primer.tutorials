---
title: 'Data: Files'
author: Shyamsai Bethina
tutorial:
  id: data-files
output:
  learnr::tutorial:
    progressive:  true
    allow_skip::  true
runtime: shiny_prerendered
description: Reading data from files.
---

```{r setup, include = FALSE}
library(learnr)
library(tutorial.helpers)
library(tidyverse)
library(janitor)
library(readxl)
library(jsonlite)
library(knitr)
library(googlesheets4)
library(googledrive)

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 600, 
        tutorial.storage = "local") 

# We need this call to allow us to interact with public Google Sheets. 

gs4_deauth()

tbl_1 <- tibble(a = 1 , b = 2, c = 3)

iris_p <- iris |> 
  ggplot(aes(x = Sepal.Length, y = Sepal.Width)) +
  geom_jitter() +
  labs(title = "Sepal Dimensions of Various Species of Iris",
       x = "Sepal Length",
       y = "Sepal Width")

example_1 <- tibble(name = c("Miguel", "Sofia", "Aya", "Cheng"), 
                    student_id = 1:4, exam_1 = c(85, 94, 87, 90), 
                    exam_2 = c(86, 93, 88, 91))

json<- '[
  [1, 2, 3, 4],
  [5, 6, 7, 8],
  [9, 10, 11, 12]
]'
```

```{r copy-code-chunk, child = system.file("child_documents/copy_button.Rmd", package = "tutorial.helpers")}
```

```{r info-section, child = system.file("child_documents/info_section.Rmd", package = "tutorial.helpers")}
```


<!-- Needs an Introduction and a Summary. Maybe this is the core of the enw Data: Overview tutorial? -->

<!-- Figure out authentication so we can create some Google Sheets. -->

<!-- realising that #dplyr::select() can also simultaneously rename columns! -->






## JSON files 
### 

An increasingly common format for sharing data is JavaScript Object Notation or JSON. 

JSON is a standard text-based format for representing structured data based on JavaScript object syntax.

### Exercise 1

Consider the contents of the file `test_1.json`:

```{r}
cat(readLines("data/test_1.json"), sep = "\n")
```

### 

Write code for reading this JSON file into R as a tibble. Use the `fromJSON()` function from the [**jsonlite**](https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html) package.

```{r json-files-1, exercise = TRUE}

```

```{r json-files-1-hint-1, eval = FALSE}
fromJSON("data/test_1.json")
```

### 

If there are "null" values in the file, you can specify how to encode those values with the `null` argument in `fromJSON`.


### Exercise 2

Consider the following tibble, which is saved in the environment as an object called `example_1`.

```{r}
tibble(name= c("Miguel", "Sofia", "Aya", "Cheng"), 
                student_id = 1:4, exam_1 = c(85, 94, 87, 90), 
                exam_2 = c(86, 93, 88, 91))
```

### 

Write code to convert the following tibble into JSON format. Use the `toJSON()` function from the **jsonlite** package.

```{r json-files-2, exercise = TRUE}

```

```{r json-files-2-hint-1, eval = FALSE}
toJSON(example_1)
```

### 

`toJSON()` actually has the same arguments as `fromJSON()`, meaning that you can use `null`, `na`, `pretty` and many more arguments to customize the results.

### Exercise 3

After converting from a tibble to the JSON format, it is hard to read the JSON format. To fix this, use the previous code and set the second argument `pretty` equal to `TRUE`.

```{r json-files-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r json-files-3-hint-1, eval = FALSE}
toJSON(example_1, pretty = ...)
```

### 

The `pretty` argument comes from the [**prettify**](https://www.rdocumentation.org/packages/papeR/versions/1.0-5/topics/prettify) package, run `??prettify` to learn more about it.


### Exercise 4

Try reading from the `json` object which has already been loaded with JSON array data. Use `fromJSON()` to display the data in a tibble.

```{r json-files-4, exercise = TRUE}

```

```{r json-files-4-hint-1, eval = FALSE}
fromJSON(json)
```

### 

As you can see, `fromJSON()` can display arrays as well, which can be useful for datasets that include matrices. You can do math operations with them as well! 

### Exercise 5

You can also write information like arrays or matrices to a JSON format using `toJSON()`. 

Display a 3x3 array in JSON format by creating 3 arrays structured like `[1, 2, 3]`, containing them in a larger array, and then passing them into `toJSON()`.

```{r json-files-5, exercise = TRUE}

```

```{r json-files-5-hint-1, eval = FALSE}
json2 <- '[[..., ..., ...], [..., ..., ...], [..., ..., ...]]'

```

```{r json-files-5-hint-2, eval = FALSE}
json2 <- '[[..., ..., ...], [..., ..., ...], [..., ..., ...]]'
toJSON(json2)
```

### 

Because JSON files can so easily store complex matrix data, they're often used in APIs and websites. This makes `fromJSON()` invaluable when you're pulling data off the Internet, as the data will often come in a JSON file. 

Vice versa, `toJSON()` is useful for when you want to send data across the Internet due to its light weight (there's very little extra formatting included in the file and it's mostly data).

## Parsing a vector
### 

There are many `parse_*()` functions that break down the most important parts of an individual vector.

### Exercise 1

People write numbers differently in different parts of the world. For example, some countries use `.` in between the integer and fractional parts of a real number, while others use `,`.

### 

To begin, use the function  `parse_double()` with the argument "1.23".

```{r parsing-a-vector-1, exercise = TRUE}

```

```{r parsing-a-vector-1-hint-1, eval = FALSE}
parse_double("1.23")
```

### 

There are other `parse_*` functions such as `parse_logical()`, `parse_integer()`, and `parse_character()`.

### Exercise 2

What if the file you worked with used a comma to denote a decimal mark? Many functions in the [**readr**](https://readr.tidyverse.org) package provide a “locale” argument. You provide an object that specifies parsing options that differ from place to place. You can override the default value of `.` by creating a new locale and setting the `decimal_mark` argument.

### 

Use `parse_double()` with the argument "1,23". The second argument should set `locale` to `locale(decimal_mark = ",")`.

```{r parsing-a-vector-2, exercise = TRUE}

```

```{r parsing-a-vector-2-hint-1, eval = FALSE}
parse_double("1,23", locale = locale(..))
```

Note that `locale` is both an argument for `parse_*` functions and the name of a function itself, on which create a local object. See `?readr::locale` for [details](https://readr.tidyverse.org/articles/locales.html).

### Exercise 3

The function `parse_number()` ignores non-numeric characters before and after the number. 

### 

Use `parse_number()` with the argument "$100". Then, on the line below, use `parse_number()` again with the argument "20%".


```{r parsing-a-vector-3, exercise = TRUE}

```

```{r parsing-a-vector-3-hint-1, eval = FALSE}
parse_number("$100")
parse_number("20%")
```

### 

Unlike `parse_integer()` and `parse_double()`, `parse_number()` can parse both integers and doubles.

### Exercise 4

Use `parse_number()` with the argument "The cost of the package is $40.75" 

```{r parsing-a-vector-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r parsing-a-vector-4-hint-1, eval = FALSE}
parse_number("The cost of ...." )
```

<!-- DK: So many knowledge drop possibilities! -->

### Exercise 5

The function `parse_date()` allows you to parse a date. The function requires the following criteria: a four digit year,  a `-` or `/`, the month, a `-` or `/`, then the day. An example would be "2010-10-01".

### 

Use `parse_date()` to parse the following date: "2009-12-06"

```{r parsing-a-vector-5, exercise = TRUE}

```

```{r parsing-a-vector-5-hint-1, eval = FALSE}
parse_date("...")
```

### 

This function is very strict about it's format, there are other functions such as `format_iso_8601()` and `parse_datetime()` which can parse dates and times.

### Exercise 6

Let's have some practice with `parse_datetime()`. It requires a format where the components of a date are organized from biggest to smallest: year, month, day, hour, minute, second.

### 

Use `parse_datetime()` with the argument "2010-10-01T2010".

```{r parsing-a-vector-6, exercise = TRUE}

```

```{r parsing-a-vector-6-hint-1, eval = FALSE}
parse_datetime("2010-10-01T2010")
```

### 

The user can also specify which number is the month, day and year by using the `%` symbol which allows more flexibility. Type "?parse_datetime" in the console to see examples.


```{r download-answers, child = system.file("child_documents/download_answers.Rmd", package = "tutorial.helpers")}
```
