---
title: Code
author: Varun Dommeti
tutorial:
  id: code
output:
  learnr::tutorial:
    progressive: yes
    allow_skip: yes
runtime: shiny_prerendered
description: Introduction to R scripts, R Markdown and Quarto.
---

```{r setup, include = FALSE}
library(learnr)
library(primer.tutorials)
library(primer.data)
library(tidyverse)
library(knitr)
library(gistr)
knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local")
```

```{r copy-code-chunk, child = "../../child_documents/copy_button.Rmd"}
```

```{r info-section, child = "../../child_documents/info_section.Rmd"}
```


<!-- Delete useless images. -->

<!-- Add more images? Like the terminate jobs window. Explain it. And explain, with an image, the necessity of opening in a new session. No worries if you mess up though. You can just re-open the tutorial and all your work is saved.
-->

<!-- Build the R script graphic line by line, just like we do in the Basic Plots tutorial. -->

<!-- Restart R session several times? -->

<!-- Use ls(). Talk about environment. -->

<!-- ?ggsave question -->

<!-- Don't use index.Rmd -->


<!-- Use getwd() to determine the path of the current project. Mention that students should ensure that there are no spaces, if it all possible. Do this at end of Checking your Set Up. Deal with and/or check and/or educate about OneDrive and other Cloud-based locations where they are doing work. Do this at end of Checking your Set Up. Maybe the advice is to ensure that your projects are located on your machine, not in the cloud. This is possible to do! I'm going to try advising them, but I don't know how to check if it's on the cloud or not. I did find a tutorial here:  https://medium.com/@ValidScience/how-to-fix-rstudios-package-installation-on-windows-10-c1e602bf3a1f about dealing with OneDrive with R and its packages and stuff. -->

<!-- Liam: Every time we create a new project, it quits out of the current R Studio session, which means that the tutorial itself closes. Which is confusing! And this happens multiple times in this tutorial. Should we have two R Studio sessions, like we do in later tutorials. -->

## Overview
###

Up until now, you have been typing your code into the neat boxes provided by our tutorials. What if you want to start working on your own? In this tutorial you will learn how to use R Script and R Markdown files, as well as how to publish your work using RPubs!

## Checking your setup

### 

This tutorial assumes that you have read and completed all the steps in the [Getting Started](https://ppbds.github.io/primer/getting-started.html) chapter of the *Primer*.


### Exercise 1

In the [Getting Started section](https://ppbds.github.io/primer/getting-started.html), you should have installed the **remotes**, **tidyverse**, **usethis**, and **primer.tutorials** packages.

### 

Load the following libraries in the Console

`library(tidyverse)`   

### 

Run `search()` in the Console to see the libraries that you've currently loaded, then copy and paste the result into the tutorial into the space below.

```{r checking-your-setup-1}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 3)
```

### 

There should be strings such as "package:tidyverse" in the output. These are the packages that you are using in your project.

### Exercise 2

Now to make sure we will always be working from a *blank slate* for our R projects, meaning R won't store information between restarts, run `rstudioapi::writeRStudioPreference("save_workspace", "never")` in your console. While you should have done this in the Getting Started tutorial, we will ensure that you do it again.

### 

Run `rstudioapi::readRStudioPreference(name = "load_workspace", default = "Code failed.")` in the Console. Copy and paste both the command and the result into the space below.

```{r checking-your-setup-2}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 3)
```

### 

The result should be FALSE.

<!-- DK: Where are you? Is that a good place? Look at the top of the Console tab. What version of R? -->

## R Projects
### 

Whenever you start a new project, you will want to store it somewhere on your computer to find it easily. For this purpose, you should create a `projects` folder on your `Desktop` or in some other convenient location. Wherever you place the `projects` folder, make sure that there are no spaces in any of the folder names above it.  We'll be using this folder to keep our R projects organized and separated from the rest of your files.

Remember that you shouldn't use spaces in file or folder names, so you might want to use a dash or period to separate words instead.

### Exercise 1
### 

Run `getwd()` in the Console. Copy and paste both the command and the result into the space below.

```{r r-projects-1}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 3)
```

### 

This should return the folder path of your current project. Every R project is stored as a folder in your `projects` folder, so you should always be careful to make sure you are in the project folder you are working on.

<!-- DK: There should be 6 - 10 questions here. Students don't understand their computers! They don't know how paths work. They don't know where files are stored. -->

Now we can make a new project for this tutorial. This can be done by going to File -\> New Project -\> New Directory -\> New Project 

Name your new project "First-R-Project", and make sure that the project subdirectory is your newly created `projects` folder. Check the box in the bottom left to open in a new session so you don't close this tutorial, and hit create project.

Good Work! You've created a new R Project.

## R Scripts
### 

So now we have a new project to work in, but what if we want to start working? We could use the console directly, but its difficult to type more than a few lines of code into the console at a time.

That's when we use **R Scripts**. Think of these like code chunks but as an entire file. They only use R code and don't have any text, but they're very useful for when you want to create a graph or do an operation quickly. They're often used to create graphs or other objects, which are then stored for later use.

### Exercise 1

Let's create an R Script file so that we can start coding in R and creating more graphs.

<!-- DK: Explain untitled. Show several questions of interactive work. -->

You can create an R Script by going to File -\> New File -\> R Script. Save the file and name it "FirstRScript.R".

Run `list.files()` in the Console to list all of the files. Copy and paste the output into the space below.

```{r r-scripts-1}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

###

You should see the `FirstRScript.R` file in this output.

### Exercise 2

As you can see, this is a blank file. However, we can put in R code in this file and run it.

Let's try making this graph in our R Script file:

```{r}
hist_p <- ggplot(data = qscores, 
                 mapping = aes(x = rating)) +
  geom_histogram(bins = 5, 
                 color = "white", 
                 fill = "coral") + 
  labs(title = "Histogram of Student Ratings\nof Harvard Classes", 
       subtitle = "Ratings of 1 and 2 are very rare", 
       x = "Rating", 
       y = "Count", 
       caption = "Source: Harvard Q-Guide (2018-2019)")

hist_p
```

### 

First off, we need to load our libraries.

Load the `tidyverse` and `primer.data` libraries into your R Script file using the `library()` command.

### 

In the Console tab, run `readLines("FirstRScript.R")` and copy-paste the output into the space below.

```{r r-scripts-2}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

This should output all of the lines in the `FirstRScript.R` file, including the `library()` commands.

### Exercise 3

Now start a `ggplot()` and set the `data` argument to `qscores`. Map `rating` to the x-axis to see the distribution of Harvard course ratings. Then add the layer `geom_histogram()`.

In the Console tab, run `readLines("FirstRScript.R")` and copy-paste the output into the space below.

```{r r-scripts-3}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

To run an entire `.R` document, use the shortcut cmd/ctrl + shift + enter, or highlight the section to run and hit the run button in the top right. Using the run button on its own or using the shortcut cmd/ctrl + enter will run the line your cursor is on.

### Exercise 4

Add white vertical borders dividing the bins by setting `color` equal to `"white"` within `geom_histogram()`. 

In the Console tab, run `readLines("FirstRScript.R")` and copy-paste the output into the space below.

```{r r-scripts-4}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

This separates the different rectangles and makes the graph look better. If you want to change the color of the rectangles themselves instead of the border, use the `fill` argument.

### Exercise 5

Now, this graph has a lot of different rectangles, each representing its own rating. But we just want 5 rectangles, each representing the number of reviews for that star (we don't want decimal ratings). We can show this by using the `bins` argument.

### 

Specify the number of bins to be 5 using the `bins` argument in `geom_histogram()`.

In the Console tab, run `readLines("FirstRScript.R")` and copy-paste the output into the space below.

```{r r-scripts-5}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

You can also use the `binwidth` argument to change the width of the rectangles.

### Exercise 6

Now use `labs()` to set an appropriate title, subtitle, axes labels, and caption for the graph.

Reminder: This is what our graph should look like.

```{r}
hist_p
```

In the Console tab, run `readLines("FirstRScript.R")` and copy-paste the output into the space below.

```{r r-scripts-6}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

###

### Exercise 7 

Ok, so now we have a plot stored in our R script. How do we use this plot for other things? Right now we have to run our script every time we want to see the plot, which is a little inconvenient. 

Here we can use the extremely useful `ggsave()` function. `ggsave()` creates a png file for a plot and saves it in your current directory. This allows you to use the plot outside of the script file without needing to run the code every time.

First, we need to save our entire graph to an object, which can be done by setting our pipe equal to a variable. Call this variable `hist_p`.

Now using the `ggsave()` function we can create a png of our plot from our code. In `ggsave()`, set `plot` to `hist_p`, `file` to `"hist_p"` and `scale` to `1.3`. 

In the Console tab, run `list.files()` and copy-paste the output into the space below.

```{r r-scripts-7}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

This lists the files in your project directory. You should see your R Project as well as the `hist_p.png` file containing your plot. In the bottom right corner of your workspace in the `files` tab, click on the png to view your plot.

If the title text flows out of the image, you might want to mess with the `scale` argument in `ggsave()` to find a better image size.

## R Markdown
### 

R Markdown files are the primary way that we are going to be coding in R.

R Markdown is a file format for making dynamic documents with R. An R Markdown document is written in markdown (an easy-to-write plain text format) and contains chunks of embedded R code. In fact, the tutorial that you are completing right now was made in an R Markdown file!

These files are special because unlike R scripts they can be **knitted** into *reports* (or HTML files) that are used in websites. These reports can have both regular text, and code blocks. We'll be publishing an R Markdown file to RPubs.

You can learn more about how to write R Markdown files with [RStudio's website introducing R Markdown](https://rmarkdown.rstudio.com/articles_intro.html).

### Exercise 1

First off, let's create an R Markdown file. Go to File -\> New File -\> R Markdown. Title the file "index.Rmd" and proceed through the creation process.

```{r}
include_graphics("images/new_rmd.png")
```

Run `list.files()` in the Console and copy-paste the result below. The title of your R Markdown file should be one of the results.

```{r r-markdown-1}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### Exercise 2

The default R Markdown file should look like this:

```{r, out.width="875px"}
include_graphics("images/rmd_example.png")
```

### 

Each section has its own value.

### 

As you can see, a lot of the text is actually plain text. However, there are code chunks that display R code. Here's an example of an R code chunk.

```{r}
knitr::include_graphics("images/rmd_chunk_1.png")
```

```{r echo = FALSE}
plot(cars)
```

This allows you to use R to create graphs then display it in an R Markdown file with plain text descriptions.

Delete everything except the YAML header (contained by dashes) and the first code chunk (often known as the setup code chunk), then add "This is my first R Markdown text." at the bottom. Then press the "Knit" button at the top to display your rendered R Markdown file. This should have your custom text.

### 

Run `readLines("index.Rmd") |> tail()`

```{r r-markdown-2}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

This should return the last 6 lines of your R Markdown file.

### Exercise 3

Now, we earlier saw how a majority of the text within R Markdown files is just plain text. However, there was that one piece that wasn't the R Markdown Header.

### 

Essentially, R Markdown allows for Markdown syntax. That lets you **bold**, *italicize*, or `code` text. By doing this, you can format your report easily and make it look nice by just adding in a few extra symbols.

### 

Make the text created in the previous section a header by adding `##` at the beginning, then adding this text under that as a description: `You can do a lot of cool things in R Markdown like **bold** and *italic* text.` Knit the file again and make sure that everything is showing up correctly.

### 

Run `readLines("index.Rmd") |> tail()` in the Console, then copy-paste the command and the output below.

```{r r-markdown-3}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

This should contain the text that you created in this exercise as well as the previous text. You can find a full list of R Markdown formatting styles and commands [here](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf).

### Exercise 4

Now let's try to add code chunks into our R Markdown file. Under the text that we added earlier, add a code chunk either by pressing the Add Chunk command at the top of the editor (the green C button with a plus sign next to it). The code chunk should look like this:

```{r}
knitr::include_graphics("images/rmd_chunk_2.png")
```

### 

Run `readLines("index.Rmd") |> tail()` in the Console, then copy-paste the command and the output below.

```{r r-markdown-4}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

This should show the code chunk you created.

### Exercise 5

Let's try graphing the **iris** data within our code chunk.

### 

First of all, we need to load the libraries that we need. In the setup chunk, load the **tidyverse** library using the `library()` command. Your setup chunk should look like this:

```{r}
knitr::include_graphics("images/rmd_chunk_3.png")
```

This lets R know what packages you're going to be using throughout this R Markdown file.

### 

Run `readLines("index.Rmd") |> head(15)` in the Console, then copy-paste the command and the output below.

```{r r-markdown-5}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

We load our libraries in the setup chunk in order to run the `library()` commands first. This lets us use them later without any issues since they've already been called.

### Exercise 6

Go back to the code chunk that you manually created. This is where we're going to be coding for the rest of this section.

### 

Let's create the following scatter plot in an R Markdown file:

```{r}
scat_p <- ggplot(data = iris, 
                 mapping = aes(x = Sepal.Width, 
                               y = Sepal.Length, 
                              color = Species)) +
  geom_point() +
  labs(title = "Measurements for Different Species of Iris",
       subtitle = "Virginica has the longest sepals",
        x = "Sepal.Width",
        y = "Sepal.Length", 
       caption = "Fisher (1936)")
scat_p
```

This graph should be similar to ones you have created in previous visualization tutorials.

### 

Within `ggplot()`, set `data` to `iris`. Also, map `Sepal.Width` to the x-axis and `Sepal.Length` to the y-axis. Add the layer `geom_point()`. It should look like the code below.

```{r}
knitr::include_graphics("images/rmd_code_ex_1.png")
```

### 

Run `readLines("index.Rmd") |> tail(10)` in the Console, then copy-paste the command and the output below.

```{r r-markdown-6}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

Running an Rmd file is similar to running an R script file, but using cmd + shift + enter now only runs your current code chunk, so keep that in mind. You can also use the run button in the top right corner, which now has a drop down menu to run specific parts of the markdown file.

### Exercise 7

Now we want to add a `color` aesthetic based on the different species of the iris flower. Set the argument `color` to `Species` inside the `aes()` function.

Run `readLines("index.Rmd") |> tail(10)` in the Console, then copy-paste the command and the output below.

```{r r-markdown-7}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

The output should include the last 10 lines of code in your R Markdown file.

### Exercise 8

We just built the basic graph, but it still looks ugly. Labels are important for adding context to the graph and making it easy to understand.

### 

Use the `labs()` function to add a title and axis labels to the graph.

Set the `title` to `"Measurements for Different Species of Iris"` and the `subtitle` to `"Virginica has the longest sepals"`.

To label the axes, set `x` to `"Sepal.Width"` and `y` to `"Sepal.Length"`. Set the `caption` to `"Fisher (1936)"`.

Run `readLines("index.Rmd") |> tail(10)` in the Console, then copy-paste the command and the output below.

```{r r-markdown-8}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

Reminder: This is generally what our graph should look like.

```{r}
scat_p
```

### 

Congratulations on completing the plot. Go ahead and knit the file to see what it looks like.

### Exercise 9

Now, we just used a code chunk because we wanted to do a full graph. But that's very long and annoying, and it doesn't let you put anything in the same line as your text. This is when we can use inline R code.

### 

Inline R code is essentially a way for you to put R calculations in the same line as your text. For example, let's run the following R code chunk.

```{r}
knitr::include_graphics("images/rmd_chunk_4.png")
```

```{r}
x <- 1234567890
x
```

What if we want to include whatever value of the `x` variable in our lines of text?

We can display variable values in the same line as normal text by using inline R code. For example, here's what the number looks like in the R Markdown file.

The variable x has a value of: `r scales::comma(x)`.

And here's what the R Markdown text looks like:

The variable x has a value of: `` `r knitr::inline_expr("scales::comma(x)")` ``.

### 

As you can see, it's just a condensed version of a full code chunk. We declare the language (R) and then state our function (`scales::comma(x)`). By doing this, we can put R code in the same line as actual text.

### 

Let's try this in our actual R Markdown file. To start, add a new code chunk that declares the `x` variable and sets its value to `1234567890`.

### 

Run `readLines("index.Rmd") |> tail(10)` in the Console, then copy-paste the command and the output below.

```{r r-markdown-9}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

This sets up our code function by declaring the value of x.

### 

If you want to hide this code chunk from when you generate the report, add "echo=FALSE" as an argument by the "r" at the top of the code chunk. The first line of the chunk should look like `{r, echo=FALSE}`.

### Exercise 10

Now let's actually use that `x` variable in some inline R code. While you can just type out the values into an Rmd, it is always recommended to calculate the value of a piece of data on the fly, so that if the dataset is modified, the text remains accurate.

### 

Add the following line at the bottom of your R Markdown file, after the code chunk created in the last exercise.

The variable x has a value of `` `r knitr::inline_expr("scales::comma(x)")` ``.

### 

Run `readLines("index.Rmd") |> tail(10)` in the Console, then copy-paste the command and the output below.

```{r r-markdown-10}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

When you knit your file, you should be able to see that the `` `r knitr::inline_expr("scales::comma(x)")` `` has been replaced with another value that's formatted correctly.

### 

This is why inline R code is valuable, as it allows you to format numbers or show functions in the same line as your text.

### Exercise 11

Remember our .png file from earlier? Lets add that image to our Rmd! 

###

In the console, install the `knitr` package using `install.packages()`, and add `library(knitr)` to your setup chunk at the top of your R Markdown. Run the setup chunk again.

###

Make a new header with the title "Harvard Histogram". Under this header, create a new code chunk. Remember to use the argument `echo = FALSE` to stop your code from showing up upon knitting the file.

In your new code chunk, use the function `include_graphic()`. Set the argument to the name of your .png. Remember to use quotes. The command should look something like `include_graphics("hist_p.png")`.

###

Knit the file, and take a look at your completed R Markdown. It should now include both your first graph and the graph from your R script.

Run `readLines("index.Rmd") |> tail(10)` in the Console, then copy-paste the command and the output below.

```{r r-markdown-11}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```



### 

Congratulations on creating a full R Markdown file. You have learned how to create plots, add text, use inline R code, and include images. Now let's try to publish it to the Internet.

## Publishing to RPubs
### 

We'll be publishing our R Markdown files on the Internet by using [RPubs](https://rpubs.com/), a free web publishing service. This is a fairly simple process, but you will need to create an RPubs account.

### Exercise 1

Knit the R Markdown file that you've been working in so far. By knitting, you are generating a report written in HTML, which is what Rpubs publishes on the web.

### 

Run `list.files()` in the Console, then copy-paste the command and the result below.

```{r publishing-to-rpubs-1}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

You should see a `.html` file with the same name as your R Markdown file in the result.

### 

It's recommended to change the YAML header to get rid of information like the date and title, as it looks bad in the final knit. However, make sure not to mess with the rest of the YAML formatting because it is a very structurally sensitive language. You can learn more about YAML editing at [bookdown.org](https://bookdown.org/yihui/bookdown/r-markdown.html).

### Exercise 2

Notice a blue icon in the upper right-hand corner that reads `Publish`. Click it.

```{r, out.width="875px"}
include_graphics("images/rpubs-5.png")
```

### Exercise 3

You will be asked whether you want to publish to Rpubs or to RStudio Connect. For our purpose here we will be using RPubs. You will get a reminder that all documents you publish on RPubs are publicly visible. Click "Publish".

```{r}
include_graphics("images/rpubs-6.png")
```

### Exercise 4

This will take you to the RPubs website. You will need to create an account. Follow the steps as prompted.

```{r}
include_graphics("images/rpubs-7.png")
```

### Exercise 5

Add document details. Name your document. Add a meaningful slug (a unique website name that's often just the name of your project), otherwise you will end up with an ugly, long address you didn't choose and can't remember. You can leave the description blank if you don't want to add one.

```{r}
include_graphics("images/rpubs-8.png")
```

### Exercise 6

Hit "Continue". You have now published your first document to RPubs! People can now access it on the internet and see what you did for this file!

```{r, out.width="875px"}
include_graphics("images/rpubs-9.png")
```

### Exercise 7

You finished publishing your page to RPubs! Put the link to your RPubs page in the space below.

```{r publishing-to-rpubs-7}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 2)
```

### 

Keep in mind that this is a website that can be found on the internet.

## Summary

Good work on finishing this tutorial! You now know how to use R Scripts, R Markdowns, how to publish a website using RPubs, and how to use a plethora of useful R commands!

```{r download-answers, child = "../../child_documents/download_answers.Rmd"}
```
